---
layout: post
title: Minio踩坑记录
category: 记录
tags:
  - Minio
---

记录一些Minio使用问题和处理方式。

<!-- more -->

## 版本

新版各种bug和不好用，建议直接用旧版：`minio/minio:RELEASE.2021-03-26T00-00-41Z`

## 改admin账号密码

如果容器和文件存储已经建好，而且需要修改admin用户名或密码，不要直接在环境变量那里改。按以下方式操作：

1. 停止minio容器
2. 删除minio数据文件中的.minio.sys/config目录
3. 修改配置（docker-compose.yaml），修改MINIO_ROOT_USER、MINIO_ROOT_PASSWORD
4. 使用`docker compose up -d`重建minio容器

## 将数据存储至NFS中

此问题是Docker的事，与Minio无关。项目中Minio用到了所以记在这里。

假设挂载NFS存储，具体路径是`/nfs`，配置docker-compose.yaml时，不能直接使用volumes参数将`/nfs`映射过去，否则minio性能极差，无法使用。

假如挂载NFS的命令是

```
mount -t nfs -o vers=4,proto=tcp,rsize=1048576,wsize=1048576,hard,intr,timeo=600 172.16.123.123:/proj/minio /nfs
```

那么对应的配置方法是：

```yaml
volumes:
  # 注意此处与下方对应
  minio-nfs:
    driver: local
    driver_opts:
      type: nfs
      o: addr=172.16.123.123,rw,nfsvers=4,async
      device: :/proj/minio

services:
  minio:
    image: minio/minio:RELEASE.2021-03-26T00-00-41Z
    environment:
      MINIO_ROOT_USER: 账号
      MINIO_ROOT_PASSWORD: 密码
    volumes:
      # 注意此处
      - minio-nfs:/data
    ...
```

此外，在文件数量增大到万级时，应考虑适当新建文件夹，将文件分散存储，否则会影响性能。
