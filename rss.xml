<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>plusNaN</title>
  
  
  <link href="https://plusnan.me/rss.xml" rel="self"/>
  
  <link href="https://plusnan.me/"/>
  <updated>2024-03-03T14:12:45.580Z</updated>
  <id>https://plusnan.me/</id>
  
  <author>
    <name>plusNaN</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Linux系统中给Docker开启IPv6</title>
    <link href="https://plusnan.me/2024/02/01/docker-ipv6/"/>
    <id>https://plusnan.me/2024/02/01/docker-ipv6/</id>
    <published>2024-01-31T16:00:00.000Z</published>
    <updated>2024-03-03T14:12:45.580Z</updated>
    
    <content type="html"><![CDATA[<p>鉴于网上的教程太多，而且很多是旧资料，并且官网的资料也是既不清晰又不准确，因此这里记录一个简单可行（2024年2月）的操作步骤。</p><span id="more"></span><h2 id="本教程前置条件">本教程前置条件</h2><ol type="1"><li>Linux系统</li><li>服务器有固定IPv6地址，而且进行了正确配置。</li><li>单节点</li></ol><h2 id="一查询服务器的ip段">一、查询服务器的IP段</h2><p>使用<code>ip addr</code>或<code>ifconfig</code>命令查询一下服务器的IPv6地址段：</p><pre class="line-numbers language-none"><code class="language-none"># ip addr ...2:  eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000    link&#x2F;ether f2:3c:92:24:24:c2 brd ff:ff:ff:ff:ff:ff    inet ***.***.***.***&#x2F;24 brd ***.***.***.*** scope global eth0       valid_lft forever preferred_lft forever    inet6 2400:1234::bbbb:cccc:dddd:eeee:ffff&#x2F;64 scope global dynamic mngtmpaddr noprefixroute       valid_lft 5117sec preferred_lft 1517sec    inet6 fe80:1234:aaaa:bbbb:cccc:dddd:eeee:ffff&#x2F;64 scope link       valid_lft forever preferred_lft forever...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从上面可知，服务器的IP地址是<code>2400:1234::bbbb:cccc:dddd:eeee:ffff</code>，掩码64位，所以IP段就应该是<code>2400:1234:0:bbbb::/64</code></p><h2 id="二配置docker开启ipv6">二、配置Docker开启IPv6</h2><p>编辑<code>/etc/docker/deamon.json</code>文件：</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"ipv6"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token property">"fixed-cidr-v6"</span><span class="token operator">:</span> <span class="token string">"2400:1234:0:bbbb::/64"</span><span class="token punctuation">,</span>    <span class="token property">"experimental"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token property">"ip6tables"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>fixed-cidr-v6</code>部分替换成你的服务器的IP段。</p><p>重启Docker，重启完成后输入<code>docker network inspect bridge</code>，在输出内容中找到<code>EnableIPv6</code>，如果它的值是true，说明Docker已开启IPv6。</p><h2 id="三使容器启用ipv6">三、使容器启用IPv6</h2><h3 id="docker-run模式">docker run模式</h3><p>创建一个支持IPv6的网络：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> network create <span class="token parameter variable">--ipv6</span> <span class="token parameter variable">--subnet</span><span class="token operator">=</span><span class="token string">"fc00:0:0:1::/64"</span> mynet<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>其中<code>fc00:0:0:1::/64</code>也可以换成其他内网网段。</p><p>删掉现有容器，然后重新创建容器，并使用<code>--network</code>参数指定网络，例如</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-v</span> xxxx <span class="token parameter variable">-p</span> xxxx <span class="token parameter variable">--network</span> mynet xxxx/xxxx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>容器启动成功后，使用dockerinspect查看容器信息，如果其中的<code>GlobalIPv6Address</code>出现IPv6地址说明启用成功。</p><h3 id="docker-compose模式">docker-compose模式</h3><p>修改docker-compose.yaml配置文件，在最后面增加（如果已有类似内容，请根据实际情况调整）：</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">networks</span><span class="token punctuation">:</span>  <span class="token key atrule">default</span><span class="token punctuation">:</span>    <span class="token key atrule">enable_ipv6</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>    <span class="token key atrule">ipam</span><span class="token punctuation">:</span>      <span class="token key atrule">config</span><span class="token punctuation">:</span>        <span class="token punctuation">-</span> <span class="token key atrule">subnet</span><span class="token punctuation">:</span> fc00<span class="token punctuation">:</span>0<span class="token punctuation">:</span>0<span class="token punctuation">:</span>1<span class="token punctuation">:</span><span class="token punctuation">:</span>/64<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>删除现有容器，然后使用<code>docker network ls</code>和<code>docker network rm xxx</code>删除compose创建的网络。容器和网络删除完成后，使用<code>docker compose up -d</code>来重新创建容器。</p><p>如果在<code>docker compose up -d</code>时报错，提示<code>pool overlaps with other one on this address space</code>，说明你忘记删除network了，手工删掉即可。</p><p>容器启动成功后，使用dockerinspect查看容器信息，如果其中的<code>GlobalIPv6Address</code>出现IPv6地址说明启用成功。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;鉴于网上的教程太多，而且很多是旧资料，并且官网的资料也是既不清晰又不准确，因此这里记录一个简单可行（2024年2月）的操作步骤。&lt;/p&gt;</summary>
    
    
    
    <category term="教程" scheme="https://plusnan.me/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="Docker" scheme="https://plusnan.me/tags/Docker/"/>
    
    <category term="IPv6" scheme="https://plusnan.me/tags/IPv6/"/>
    
  </entry>
  
  <entry>
    <title>如何理解业余电台执照的使用范围</title>
    <link href="https://plusnan.me/2024/01/16/radio-license-range/"/>
    <id>https://plusnan.me/2024/01/16/radio-license-range/</id>
    <published>2024-01-15T16:00:00.000Z</published>
    <updated>2024-03-08T01:24:50.586Z</updated>
    
    <content type="html"><![CDATA[<p>异地使用、通信范围，这些概念太弯弯绕了，加上不同省份小执照格式还不一样，怎样才容易理解呢？直接看案例！</p><span id="more"></span><h2 id="最新情况2024-3">最新情况（2024-3）</h2><p>小执照要像大执照一样统一样式，所以就不存在这个问题了。</p><h2 id="旧文">旧文</h2><hr /><pre class="line-numbers language-none"><code class="language-none">使用范围：全国通信范围：省内台站地址：山东省济南市市中区经十一路45号1-4楼  鲁A14514<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>可以在全国使用，只能与山东省内通联</p><hr /><pre class="line-numbers language-none"><code class="language-none">使用范围：全国通信范围：省际或涉外台站地址：山东省济南市市中区经十一路45号1-4楼  鲁A14514<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>无限制，可以全国使用，并且可全国通联</p><hr /><pre class="line-numbers language-none"><code class="language-none">通信范围：省内台站地址：山东省济南市市中区经十一路45号1-4楼  鲁A14514<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>只能在台站地址（家内或车内）使用，并且只能与省内通联</p><hr /><pre class="line-numbers language-none"><code class="language-none">通信范围：省际或涉外台站地址：山东省济南市市中区经十一路45号1-4楼  鲁A14514<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>只能在台站地址（家内或车内）使用，但是可全国通联</p><hr /><pre class="line-numbers language-none"><code class="language-none">通信范围：省内台站地址：<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>可以全国使用，但只能与省内通联</p><hr /><pre class="line-numbers language-none"><code class="language-none">通信范围：省际或涉外台站地址：<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>无限制，可以全国使用，并且可全国通联</p><hr /><pre class="line-numbers language-none"><code class="language-none">通信范围：省内台站地址：山东省<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>可以在山东省使用，并且只能与省内通联</p><hr /><pre class="line-numbers language-none"><code class="language-none">通信范围：省际或涉外台站地址：全国<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>无限制，可以全国使用，并且可全国通联</p><h2 id="参见">参见</h2><ul><li><span class="exturl" data-url="aHR0cHM6Ly9mb3J1bS5oYW1jcS5jbi9kLzk1OA==">https://forum.hamcq.cn/d/958<i class="fa fa-external-link-alt"></i></span></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;异地使用、通信范围，这些概念太弯弯绕了，加上不同省份小执照格式还不一样，怎样才容易理解呢？直接看案例！&lt;/p&gt;</summary>
    
    
    
    <category term="业余无线电" scheme="https://plusnan.me/categories/%E4%B8%9A%E4%BD%99%E6%97%A0%E7%BA%BF%E7%94%B5/"/>
    
    
    <category term="执照" scheme="https://plusnan.me/tags/%E6%89%A7%E7%85%A7/"/>
    
  </entry>
  
  <entry>
    <title>如何有效地找客服反馈问题</title>
    <link href="https://plusnan.me/2023/12/21/report-issues-from-users/"/>
    <id>https://plusnan.me/2023/12/21/report-issues-from-users/</id>
    <published>2023-12-20T16:00:00.000Z</published>
    <updated>2024-03-05T13:23:58.589Z</updated>
    
    <content type="html"><![CDATA[<p>用正确的方法反馈问题，才能让客服更好地帮你解决问题。我们以打软件系统的客服为例，讲一讲打电话的注意事项。</p><span id="more"></span><h2 id="假设对方什么都不懂">假设对方什么都不懂</h2><p>客服在上岗之前，会做过基本的业务培训，能够处理一些常见问题，但他们不是技术或研发人员，所以不可能100%了解系统运作原理。</p><p>软件内部结构是很复杂的，需要团队分工协作开发。即使你能找到直接参与开发的程序员，这根“救命稻草”也不见得接触过你所用的功能。</p><p>所以反馈问题时不要假设对方什么都懂，特别是如果他们反问你问题了，该配合的还是要配合，该提供的信息还是要提供，这样他们才能知道下一步如何帮忙。</p><h2 id="先讲问题">先讲问题</h2><p>无论是打电话、发邮件还是填写问题反馈页面，务必直入主题，说清自己的诉求是什么。找人办事，你总得让对方知道你想办什么事，对吧。</p><h3 id="正面案例">正面案例</h3><ul><li>“我在使用XXX功能的时候，点击保存按钮，系统出现YYYYYY错误的提示信息”</li></ul><p>这样的话，接电话那个人就会往XXX功能方向思考。如果他不懂XXX功能方面的知识，就可以去找懂XXX的同事来帮忙了。</p><h3 id="反面教材找你们领导">反面教材：“找你们领导”</h3><p>先说问题好不好？如果问题真严重到需要找领导的程度，接电话的人也好知道找哪方面的领导。否则的话，就算把国家领导人叫过来，他连电脑屏幕上的“NullPointerException”都不知道是什么意思，怎么帮你解决呢？</p><h3 id="反面教材讲长篇故事">反面教材：讲长篇故事</h3><p>交待事情背景、操作步骤之类的事情没问题，可是不要太啰嗦。</p><p>如果讲了十分钟故事，结果客服发现你的问题是常见问题，一句话就能解决，那么你的心理阴影面积和电话费都是多少？</p><h2 id="正确地描述问题">正确地描述问题</h2><h3 id="精确地描述问题">精确地描述问题</h3><ol type="1"><li>问题的具体现象是什么？</li></ol><ul><li>是出现了错误信息，还是一片空白？</li><li>如果错误信息，是系统给出的错误提示，还是产生了不正确的数据？</li><li>错误信息的内容是什么？</li><li>……</li></ul><ol start="2" type="1"><li>错误如何产生的？</li></ol><ul><li>你做了什么操作？点了什么按钮？输入了什么数据？</li><li>其他情况出不出错？</li><li>……</li></ul><p>精确地描述，客服和技术人员就能精确定位，节约时间。</p><h4 id="反面教材系统不好用">反面教材：“系统不好用”</h4><p>系统那么大，哪个地方不好用？怎么个不好用法？您不说，我们怎么满足您的需求？</p><p>一些好的案例：</p><ul><li>“XXX功能经常转圈，每次都等很长时间才能进去”</li><li>“XXX功能，填写AAA数据时，需要经常去点YYY菜单到ZZZ页面查询，建议把两个页面放在一起”</li><li>“XXX按钮需要一个一个地点，建议做一个批量操作功能”</li></ul><p>这样技术人员才有机会把你觉得不好用的地方变得好用。</p><h4 id="反面教材系统进不去">反面教材：“系统进不去”</h4><p>怎么进不去呢？可能性太多了：</p><ul><li>你的电脑断网，网站进不去了</li><li>你的账号被锁定，没有操作权限了</li><li>你的电脑网络不稳定，点击菜单之后加载缓慢</li><li>网站的服务器不稳定，点击菜单之后加载缓慢</li><li>网站的服务器出现故障，功能发生异常</li></ul><p>你看，只说“进不去”三个字的话，客服和技术人员就需要排查每一种可能性。然而，如果你说“系统进不去，提示‘无法显示此页，确保地址正确，使用搜索引擎查找页面……’”或者“XXX功能进不去，一直转圈，别的功能没毛病”，客服就能很快知道该从哪些方面下手解决问题。</p><h3 id="尽可能提供详细信息">尽可能提供详细信息</h3><ul><li>你处理的是哪种业务？大约什么时间开始办理的？</li><li>你的账号，或者你代表的组织？</li><li>提示错误，错误的截图？</li><li>你做过哪些操作？</li><li>你有没有自己尝试解决问题？如果有，你又做了哪些操作？</li><li>你希望把业务处理成哪种状态？通过还是撤销？</li></ul><p>提供详细的信息，可以让技术人员更方便地提取数据、查找出处，节约时间。</p><h2 id="着急要明确地说出来">着急，要明确地说出来</h2><p>如果事情紧迫，反馈问题的时候一定要强调着急。如果问题要紧，但客服解决不了，他们会去找开发人员。然而搞IT的人往往都很忙，你不明确告诉他们着急，他们可能就优先忙自己事情了。</p><p>如果问题不能立马解决，最好隔一段时间催着问一下进展，以免他们忘了。</p><h3 id="典型反例贬损对方">典型反例：贬损对方</h3><p>客服与你无冤无仇，你给客服施加压力，目的应该是促进他们尽快解决问题。可是，如果你乱说话，甚至爆粗口，拿客服当出气筒，把客服或开发人员惹得心情不好了，谁还愿意帮你解决问题呢？</p><h2 id="笑一笑">笑一笑</h2><ul><li><span class="exturl" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1pM2RxQlR0aE1STQ==">河南大叔与阿里巴巴客服之间的爆笑对话<i class="fa fa-external-link-alt"></i></span></li><li><span class="exturl" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1XVlduQmJrWk5ocw==">电信客服爆笑对骂工号9527超搞笑<i class="fa fa-external-link-alt"></i></span>（粗口）</li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;用正确的方法反馈问题，才能让客服更好地帮你解决问题。我们以打软件系统的客服为例，讲一讲打电话的注意事项。&lt;/p&gt;</summary>
    
    
    
    <category term="一点人生的经验" scheme="https://plusnan.me/categories/%E4%B8%80%E7%82%B9%E4%BA%BA%E7%94%9F%E7%9A%84%E7%BB%8F%E9%AA%8C/"/>
    
    
    <category term="沟通" scheme="https://plusnan.me/tags/%E6%B2%9F%E9%80%9A/"/>
    
  </entry>
  
  <entry>
    <title>高性价比FM收音机——宝峰UV-5R与泉盛UV-K5</title>
    <link href="https://plusnan.me/2023/11/04/uv5r-uvk5-radio/"/>
    <id>https://plusnan.me/2023/11/04/uv5r-uvk5-radio/</id>
    <published>2023-11-03T16:00:00.000Z</published>
    <updated>2024-03-06T06:08:35.365Z</updated>
    
    <content type="html"><![CDATA[<p>宝峰UV-5R与泉盛UV-K5不都是网红对讲机吗？</p><p>没错，但其实也是两款高性价比的FM收音机。某些情况下，使用体验甚至可以比得上真正的收音机。</p><span id="more"></span><h2 id="两个机器的共同点">两个机器的共同点</h2><ul><li>优点<ol type="1"><li>价格便宜，才几十块钱。</li><li>如果你知道广播频率，可以直接用数字键输入。</li><li>如果你的上衣有口袋或类似的缝口，可以像保安一样把对讲机别在身上，开外放时候就不需要用手去拿着机器了。而且，因为它本来是个对讲机，所以别在身上的时候，喇叭发出的声音方向是朝向你的。</li></ol></li><li>缺点<ol type="1"><li>对讲机会优先接收对讲的信号。你可以事先把两个对讲频率调到一个没人用的频率上面。但是，如果周围有强信号干扰，这两个手台就会经常退出收音机模式。</li><li>音质不如专业收音机。当然，如果你不是专业的广播爱好者，你可能不会在乎这一点。</li><li>没有短波、中波和长波频段。如果你听这些特殊频段，还是买收音机去吧。</li><li>一般耳机无法使用，如果不想开外放，需要买特殊的K头耳机。</li></ol></li></ul><h2 id="宝峰uv-5r作为收音机的优缺点">宝峰UV-5R作为收音机的优缺点</h2><ul><li>优点<ol type="1"><li>操作方便，拧一下旋钮，按一下侧面的红色按钮，就进入收音机模式了。</li><li>搜台方便，如果不知道频率，按下*就自动给你切换到下一个台了。</li></ol></li><li>缺点<ol type="1"><li>UV-5R不支持保存频道。如果你经常听多个固定的广播台，换台可能就麻烦一些了。</li></ol></li></ul><h2 id="泉盛uv-k5作为收音机的优缺点">泉盛UV-K5作为收音机的优缺点</h2><ul><li>优点<ol type="1"><li>可以保存频道。如果有多个常听的频道，可以切换成频道模式，再用上下键来切换。</li><li>支持自动搜台并保存成频道，先按F再按2即可。</li></ol></li><li>缺点<ol type="1"><li>进入收音机模式需要分两步，先按F再按0。如果想直接用侧面的按钮当收音机按钮，你还需要弄个对讲机写频线（K头），还要在电脑上安装专门的软件去调整，如果不是业余无线电爱好者，实在不值得折腾。</li><li>搜下一个台也得分两步，先按F再按3。</li></ol></li></ul><h2 id="其他问题">其他问题</h2><p>宝峰UV-5R和泉盛UV-K5都是大功率对讲机，应当考取业余无线电台操作证书，而且给对讲机办理无线电台执照，才能合法使用。虽然拿着对讲机不像架短波电台那样容易被好事者举报，但是最好还是合法使用。</p><h2 id="结论">结论</h2><del>所以拿哪个当收音机呢？当然是几个机器都买一遍了！顺便还可以入业余无线电的坑，走向无限垫之路。</del>]]></content>
    
    
    <summary type="html">&lt;p&gt;宝峰UV-5R与泉盛UV-K5不都是网红对讲机吗？&lt;/p&gt;
&lt;p&gt;没错，但其实也是两款高性价比的FM收音机。某些情况下，使用体验甚至可以比得上真正的收音机。&lt;/p&gt;</summary>
    
    
    
    <category term="业余无线电" scheme="https://plusnan.me/categories/%E4%B8%9A%E4%BD%99%E6%97%A0%E7%BA%BF%E7%94%B5/"/>
    
    
    <category term="对讲机" scheme="https://plusnan.me/tags/%E5%AF%B9%E8%AE%B2%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>Windows 2019/2022安装OpenSSH服务端</title>
    <link href="https://plusnan.me/2023/10/18/windows-2019-ssh/"/>
    <id>https://plusnan.me/2023/10/18/windows-2019-ssh/</id>
    <published>2023-10-17T16:00:00.000Z</published>
    <updated>2024-03-05T08:58:36.326Z</updated>
    
    <content type="html"><![CDATA[<p>由于有些情况下会安装失败，这里记录一个可用（2023年10月）的操作教程。</p><span id="more"></span><h2 id="为什么要安装openssh">为什么要安装OpenSSH</h2><p>远程登到Windows敲命令吗？当然不是了，这不Windows啊！</p><p>然而ssh除了可以敲命令，还可以传文件、建隧道。这样就可以靠ssh来补充一些不足了：</p><ul><li>Windows远程桌面上传下载文件速度很慢，而且连接不稳定。FTP需要安装和配置IIS，操作比较麻烦，而且不安全。而SSH容易安装，传文件既快又稳定，而且默认情况下需要本机用户认证才能登录，保证了安全性。</li><li>如果你熟悉ssh隧道的用法，可以利用ssh来处理Windows的部分端口映射问题，例如将Windows服务器里的端口映射到本地。</li></ul><h2id="先尝试安装自带的openssh不推荐">先尝试安装自带的OpenSSH（不推荐）</h2><p>打开PowerShell，输入（大小写无所谓，下同）：</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">Add-WindowsCapability</span> <span class="token operator">-</span>Online <span class="token operator">-</span>Name OpenSSH<span class="token punctuation">.</span>Server~~~~0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1<span class="token punctuation">.</span>0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果报错，直接看本文最后面的内容。如果没报错，继续执行：</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">Set-Service</span> sshd <span class="token operator">-</span>StartupType Automatic<span class="token function">Set-Service</span> ssh-agent <span class="token operator">-</span>StartupType Automatic<span class="token function">Start-Service</span> sshd<span class="token function">Start-Service</span> ssh-agent<span class="token comment"># 检查SSH服务是否正常启动</span><span class="token function">Get-Service</span> <span class="token operator">-</span>Name <span class="token operator">*</span>ssh* <span class="token punctuation">|</span> <span class="token function">select</span> DisplayName<span class="token punctuation">,</span> Status<span class="token punctuation">,</span> StartType<span class="token comment"># 检查防火墙规则，如果未放行，需要到“高级安全Windows防火墙”中放行22端口</span><span class="token function">Get-NetFirewallRule</span> <span class="token operator">-</span>Name <span class="token operator">*</span>SSH*<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="如果安装失败了推荐">如果安装失败了（推荐）</h2><p>有时候Windows2019安装OpenSSH会出错，而且无论如何都会失败。遇到这种情况，不要气馁，也没必要浪费时间去排查原因，直接去GitHub上下载个新版本就可以了。</p><p>下载地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1Bvd2VyU2hlbGwvV2luMzItT3BlblNTSC9yZWxlYXNlcw==">https://github.com/PowerShell/Win32-OpenSSH/releases<i class="fa fa-external-link-alt"></i></span></p><p>安装完成后记得在“服务”中将SSH设置为自动启动，并且在“高级安全Windows防火墙”的“入站规则”中开放服务器的22端口。</p><h2 id="其他配置">其他配置</h2><h3 id="防火墙规则">防火墙规则</h3><p>除了在“高级安全Windows防火墙”配置，也可以使用以下PowerShell命令来添加规则：</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">New-NetFirewallRule</span> <span class="token operator">-</span>Name <span class="token string">'OpenSSH-Server-In-TCP'</span> <span class="token operator">-</span>DisplayName <span class="token string">'OpenSSH Server (sshd)'</span> <span class="token operator">-</span>Enabled True <span class="token operator">-</span>Direction Inbound <span class="token operator">-</span>Protocol TCP <span class="token operator">-</span>Action Allow <span class="token operator">-</span>LocalPort 22<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="允许免密公钥登录">允许免密（公钥）登录</h3><p>修改<code>C:\ProgramData\ssh\sshd_config</code>文件，找到下面两行内容</p><pre class="line-numbers language-none"><code class="language-none">Match Group administrators       AuthorizedKeysFile __PROGRAMDATA__&#x2F;ssh&#x2F;administrators_authorized_keys<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>把这两行删掉，或者用<code>#</code>注释掉。</p><p>再创建<code>C:\Users\你的用户名\.ssh\authorized_keys</code>文件，将你的电脑的公钥写到里面，例如：</p><pre class="line-numbers language-none"><code class="language-none">ssh-rsa AAAAB3...... 你的名字<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>保存，之后就可以直接用key登录服务器了。</p><h3 id="默认启动powershell">默认启动PowerShell</h3><p>登录进入服务器后，默认启动的是cmd。如果想换成PowerShell，可以修改注册表，或在PowerShell中输入以下命令：</p><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">New-ItemProperty</span> <span class="token operator">-</span>Path <span class="token string">"HKLM:\SOFTWARE\OpenSSH"</span> <span class="token operator">-</span>Name DefaultShell <span class="token operator">-</span>Value <span class="token string">"C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe"</span> <span class="token operator">-</span>PropertyType String <span class="token operator">-</span>Force<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="参见">参见</h2><ul><li><span class="exturl" data-url="aHR0cHM6Ly9sZWFybi5taWNyb3NvZnQuY29tL2VuLXVzL3dpbmRvd3Mtc2VydmVyL2FkbWluaXN0cmF0aW9uL29wZW5zc2gvb3BlbnNzaF9zZXJ2ZXJfY29uZmlndXJhdGlvbg==">OpenSSHServer configuration for Windows Server and Windows<i class="fa fa-external-link-alt"></i></span></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;由于有些情况下会安装失败，这里记录一个可用（2023年10月）的操作教程。&lt;/p&gt;</summary>
    
    
    
    <category term="教程" scheme="https://plusnan.me/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="ssh" scheme="https://plusnan.me/tags/ssh/"/>
    
  </entry>
  
  <entry>
    <title>威诺VR-6600PRO使用感受</title>
    <link href="https://plusnan.me/2023/09/20/vgc-6600-pro/"/>
    <id>https://plusnan.me/2023/09/20/vgc-6600-pro/</id>
    <published>2023-09-19T16:00:00.000Z</published>
    <updated>2024-03-06T03:31:26.839Z</updated>
    
    <content type="html"><![CDATA[<p>威诺VR-6600PRO是一款高端的国产车载电台。这里简单记录一些使用感受，供准备购买的人参考。</p><span id="more"></span><figure><img src="6600.png" alt="威诺VR-6600PRO，不含天馈" /><figcaption aria-hidden="true">威诺VR-6600PRO，不含天馈</figcaption></figure><h2 id="基本参数">基本参数</h2><ul><li>核准码：2015FP4442</li><li>发射频率：纯业余段，即144-148MHz、430-440MHz</li><li>接收频率：<ul><li>AM、FM电台：500kHz-1710kHz、76-108MHz</li><li>航空频率：108-136MHz</li><li>VHF频段（实测，与说明书不同）：144-148MHz</li><li>UHF频段（实测，与说明书不同）：430-440MHz</li><li>174-250MHz、300-400MHz</li><li>480-520MHz</li></ul></li><li>发射功率：5/20/50W</li></ul><h2 id="特点">特点</h2><ul><li>作为高端定位的车台，6600机器做工优良，质量可靠，皮实耐用。如果经常在外使用，不需要担心机器性能。</li><li>完全分体式设计，机头控制器、机身完全独立。如果在车上使用，机头、机身都可以灵活安装。</li><li>功能齐全，满足HAM需求。</li><li>中文菜单。</li><li>有正显屏（绿底黑字）和负显屏（黑底绿字）两种版本，推荐买负显屏版本。</li><li>支持双守，而且是真双守，如果两个频道同时呼叫，两边喇叭会一起响。</li></ul><p>如果你是HAM，不管是当作车台使用，还是放在家里当基地台使用，威诺6600都是不错的选择。</p><h2 id="瑕不掩瑜的小缺点">瑕不掩瑜的小缺点</h2><p>威诺6600还有一些小缺点：</p><ul><li>双守：双守的电台有个共同的毛病，如果你不在电台旁边，当有台友CQ时，你很难知道他是在哪个频率发的呼叫，结果还不如买两个单守的设备，只要放在两个不同位置，听声音方向就能知道是哪个频率发起的呼叫了。</li><li>写频：写频操作麻烦，电脑写频则需要买6600专用的数据线。</li><li>存储：两个信道的存储不是共用的，如果你要保存个频率，左右两边都要操作一遍。</li><li>音量旋钮：音量旋钮刻度不明显，容易看不清音量大小，在车上也不方便操作，可以考虑自己再贴个或者涂个显眼的刻度。</li></ul><h2 id="不具备的功能">不具备的功能</h2><p>6600并非万能，如果你恰好需要以下功能，那么不要买6600：</p><ul><li>蓝牙：没有蓝牙，所以不能蓝牙写频，也不能用无线手咪或方向盘上的指环PTT发射。</li><li>APRS定位：需要加装专门模块，而且体验还不如直接买个带APRS功能的车台。</li><li>同段中继：6600只支持跨段中继，即U转V或V转U，如果有同段中继需求，可以考虑买即时通D9000。</li><li>457MHz接收：懂的都懂，而且一般人都会用手台收听吧？</li></ul><h2 id="买7500还是6600">买7500，还是6600？</h2><p>威诺还有另一款产品，VR-N7500，是一款没有屏幕和操作按钮的车台，全部功能都需要使用手机APP控制。</p><figure><img src="7500.png" alt="威诺VR-N7500，不含天馈" /><figcaption aria-hidden="true">威诺VR-N7500，不含天馈</figcaption></figure><p>相比6600，7500有哪些优势呢？</p><ul><li>支持APRS，包括APRS信号收发，以及APRS地图展示（仅限通过无线电收发到的信号）。</li><li>全部APP控制，写频和切换频道都比较方便。</li><li>支持录音回放。未完全抄收时，可以像微信那样直接回放语音。</li><li>支持蓝牙通信，所以可以改用蓝牙手咪、蓝牙PTT。</li><li>支持网络频道。</li></ul><p>7500的APP叫做“HT”，支持Android和iOS系统，但Android功能更全，建议使用Android手机操作。</p><p>所以6600和7500选哪个好呢？两个都是不错的机器，选哪个就看你的功能需求和个人习惯了。如果需要APRS和蓝牙，又不介意没有屏幕，APP控制，那肯定是7500了。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;威诺VR-6600PRO是一款高端的国产车载电台。这里简单记录一些使用感受，供准备购买的人参考。&lt;/p&gt;</summary>
    
    
    
    <category term="业余无线电" scheme="https://plusnan.me/categories/%E4%B8%9A%E4%BD%99%E6%97%A0%E7%BA%BF%E7%94%B5/"/>
    
    
    <category term="威诺" scheme="https://plusnan.me/tags/%E5%A8%81%E8%AF%BA/"/>
    
  </entry>
  
  <entry>
    <title>如何学会摩尔斯电码</title>
    <link href="https://plusnan.me/2023/07/09/morse-code/"/>
    <id>https://plusnan.me/2023/07/09/morse-code/</id>
    <published>2023-07-08T16:00:00.000Z</published>
    <updated>2024-03-08T15:12:19.933Z</updated>
    
    <content type="html"><![CDATA[<p>摩尔斯电码看起来很难学，所以初学者如何才能学会摩尔斯电码呢？</p><span id="more"></span><h2 id="不要做以下事情">不要做以下事情！</h2><p>不要记点划!</p><figure><img src="code1.png" alt="不要看这个" /><figcaption aria-hidden="true">不要看这个</figcaption></figure><p>不要记那个字母和点划的关系！</p><figure><img src="code2.png" alt="也不要看这个" /><figcaption aria-hidden="true">也不要看这个</figcaption></figure><p>这些都不利于初学者学习，所以不要看，不要背。</p><p>那么以上两张图到底有什么用呢？</p><p>如果你不是初学者，已经学会摩尔斯电码，上面的东西可以帮你把生疏或遗忘的电码给捡起来。</p><h2 id="先从收听开始">先从收听开始</h2><p>先从收听开始，直接找个APP，速度调成30wpm，天天用摩尔斯电码给自己洗脑，洗一段时间之后你自然就记住了。</p><p>话是这样说，但是怎样洗脑才更科学呢？</p><p>这就要提到Koch方法了，事实上很多学习摩尔斯电码的APP或程序就是这样教学的：</p><ol type="1"><li>第一次只用两个字母洗脑，靠听声音来辨识字母。</li><li>能做到几乎不犯错之后，就增加一个新的字母，三个字母一起洗。</li><li>当再一次洗到几乎不犯错的程度之后，继续增加一个字母，四个字母一起洗。</li><li>重复以上过程，直到把所有字母都“入脑、入心、入魂”为止。</li></ol><p>在学习过程中，不要去想有几个点和几个杠，要听声音嘀嗒的节奏，脑袋也要去记这个节奏，就像听音乐或学唱歌那样。</p><p>每个人的学习能力是不一样的，所以不要强求速成。假如坚持洗了好几天，电码都没洗进你的脑袋里，可以考虑换个学习软件，或者把速度降到20wpm。</p><p>推荐APP或网站：</p><table><colgroup><col style="width: 23%" /><col style="width: 25%" /><col style="width: 24%" /><col style="width: 14%" /><col style="width: 12%" /></colgroup><thead><tr class="header"><th>名称</th><th>形式</th><th>是否花钱</th><th>级别</th><th>备注</th></tr></thead><tbody><tr class="odd"><td>MorseMania</td><td>手机APP（Android/iOS）</td><td>是</td><td>入门/进阶</td><td></td></tr><tr class="even"><td><span class="exturl" data-url="aHR0cHM6Ly9sY3dvLm5ldA==">lcwo<i class="fa fa-external-link-alt"></i></span></td><td>电脑网站</td><td>否</td><td>入门/进阶</td><td></td></tr><tr class="odd"><td><span class="exturl" data-url="aHR0cDovL3d3dy5keGF0bGFzLmNvbS9Nb3JzZVJ1bm5lci8=">Morse Runner<i class="fa fa-external-link-alt"></i></span></td><td>电脑应用</td><td>否</td><td>提高</td><td>只有Windows版，Linux或Mac可用Wine运行</td></tr></tbody></table><h2 id="开始提高难度">开始提高难度</h2><p>学会抄收单个字母以后，你就可以继续加大难度了。</p><p>这时开始你就要开始两线作战，一方面是能抄清电码，另一方面要能理解电码内容，所以一方面要洗脑听字母，另一方面要找字典背单词。</p><p>先从稍微难一点的开始，两三个字母，这就包括单词、缩略语、Q简语，等等。对于无线电的缩略语和Q简语，不建议直接去背，太多了记不住。可以每天只记一两个，再刷一刷业余无线电的考试题，积少成多。有些词语还可以像“QTH”那样有意识地使用一下，这样就更容易记忆了。</p><p>当三个字母也“入脑、入心、入魂”之后，你可以继续加大难度，抄收呼号和长单词，学习通联模板，直到最后能够抄收完整通联内容为止。</p><h2 id="学习拍发">学习拍发</h2><p>当你学会收听之后，找到有经验的HAM学习一下电键的操作手法，之后你就自然而然地学会拍发了。</p><p>需要说明的是，学电键最好有人带，不建议自学，更不要盲目高速发报。手法不正确的话，不仅效率低，而且还容易伤手。</p><h2 id="最重要的是">最重要的是……</h2><p>带着对无线电的兴趣去学习，而且要坚持学习，别“三天打鱼，两天晒网”。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;摩尔斯电码看起来很难学，所以初学者如何才能学会摩尔斯电码呢？&lt;/p&gt;</summary>
    
    
    
    <category term="业余无线电" scheme="https://plusnan.me/categories/%E4%B8%9A%E4%BD%99%E6%97%A0%E7%BA%BF%E7%94%B5/"/>
    
    
    <category term="摩尔斯电码" scheme="https://plusnan.me/tags/%E6%91%A9%E5%B0%94%E6%96%AF%E7%94%B5%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>中国用户如何注册中文维基百科账号，并且获得编辑权限</title>
    <link href="https://plusnan.me/2023/06/20/wikipedia-account/"/>
    <id>https://plusnan.me/2023/06/20/wikipedia-account/</id>
    <published>2023-06-19T16:00:00.000Z</published>
    <updated>2024-03-08T01:15:20.517Z</updated>
    
    <content type="html"><![CDATA[<p><span class="exturl" data-url="aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3dpa2kvSGVscDolRTUlQTYlODIlRTQlQkQlOTUlRTglQUUlQkYlRTklOTclQUUlRTclQkIlQjQlRTUlOUYlQkElRTclOTklQkUlRTclQTclOTE=">中文维基百科提供了官方的操作教程<i class="fa fa-external-link-alt"></i></span>，但是教程出于多样性考虑，内容比较繁杂，而且对操作者的技术水平要求非常高，因此这里重新写一个简单可行的操作教程。</p><span id="more"></span><h2 id="前提条件">前提条件</h2><ol type="1"><li>使用电脑操作</li><li>你的电脑安装了翻墙软件，而且只要启动翻墙软件，浏览器上就不需要再安装其他插件来翻墙</li></ol><p>如果你不知道如何翻墙，请先学习翻墙的操作方法。</p><p>如果你不想翻墙，也不想学习翻墙，你也可以直接访问<span class="exturl" data-url="aHR0cHM6Ly9xaXV3ZW4ud2lraS8=">求闻百科<i class="fa fa-external-link-alt"></i></span>（网址：qiuwen.wiki），该网站除了个别主题以外，其他内容与中文维基百科是基本一致的。</p><h2 id="操作步骤">操作步骤</h2><p><strong>请严格按照本教程步骤操作，教程中的每一步操作都不要省略，哪怕看起来没有任何意义：</strong></p><h3 id="一修改hosts">一、修改Hosts</h3><ol type="1"><li>先开启翻墙模式，并确认翻墙成功。如果需要测试翻墙情况，请使用Google测试。</li><li>打开<span class="exturl" data-url="aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3dpa2kvSGVscDolRTUlQTYlODIlRTQlQkQlOTUlRTglQUUlQkYlRTklOTclQUUlRTclQkIlQjQlRTUlOUYlQkElRTclOTklQkUlRTclQTclOTE=">中文维基百科的官方教程<i class="fa fa-external-link-alt"></i></span>，翻到“维基媒体服务器列表”章节，在表格中“text-lb”部分找到一个打绿勾的IP地址。</li><li>找到hosts文件，Windows系统一般位于<code>C:\Windows\System32\drivers\etc\hosts</code>，Linux或Mac系统则是用命令修改<code>/etc/hosts</code>。使用文本编辑器进行修改，在文件中加入以下内容：</li></ol><pre class="line-numbers language-none"><code class="language-none">198.35.26.96 zh.wikipedia.org198.35.26.96 login.wikimedia.org198.35.26.96 meta.wikimedia.org198.35.26.96 commons.wikimedia.org<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>注意：第一个是wiki<code>p</code>edia，后面三个是wiki<code>m</code>edia，字母不一样。实际操作时，应当把<code>198.35.26.96</code>换成你刚才查到的IP地址。</p><ol start="4" type="1"><li>修改完成后保存。</li></ol><h3 id="二注册账号">二、注册账号</h3><p>提前想好自己的用户名是什么，密码不要太复杂，邮箱也可以先忽略，申请权限的理由（见后文）也提前写好。当务之急是把账号注册出来，密码、邮箱和各种设置可以等事后挂梯子慢慢改。</p><ol type="1"><li>让翻墙软件继续开启翻墙模式，浏览器地址栏手工输入<code>https://zh.wikipedia.org</code>，打开维基百科首页。</li><li>首页加载完成后，点击右上角的三个点图标，从弹出的菜单中点击“贡献”链接。进入贡献页面后，你应该能看到一个或两个大红框，显示“IP地址被封禁”，这表示你不能在翻墙的时候注册账号。假如没有“IP地址被封禁”的提示，这说明你运气好，可以直接注册账号，然后进入下面的“三、申请IP封禁豁免权”。</li><li>这时候，<strong>不要关闭维基百科的浏览器窗口和标签，也不要再打开新窗口，而且要确保后面操作迅速，不要拖拉</strong>。</li><li>关闭翻墙模式，然后回到维基百科网站，重新点击“贡献”菜单，你应该会发现，维基百科网站仍然能访问，而且IP地址变成了真实地址，大红框也消失了。</li><li>直接点击右上角的“创建账号”链接，输入账号信息，此时应该可以注册成功了。</li></ol><p>注意：</p><ol type="1"><li>如果关闭翻墙模式后，浏览器提示“连接已重置”，说明墙已经监测到你在尝试登录维基百科，需要换个网络或者改天再试。</li><li>如果第二次进入贡献页面，发现IP被封禁的大红框未消失，而且IP地址是你的真实地址，不是翻墙节点的IP地址，那么需要换个网络再试。</li></ol><h3 id="三申请ip封禁豁免权">三、申请IP封禁豁免权</h3><p>注册成功之后，维基账号的操作还没结束，因为你挂上梯子之后，你可以看，但是不能编辑，所以要让管理员给你增加权限。</p><p>这时马上点击右上角的用户图标，在弹出的菜单中选择“留言”链接，系统会进入<code>讨论：</code>的页面。点击右侧的“添加话题”按钮，然后按照下面的格式进行申请。</p><ul><li>主题：<code>封禁申诉</code></li><li>描述：<code>&#123;&#123;unblock|我是中国大陆用户，需要使用翻墙软件来登录维基百科，但是翻墙之后账号被封禁无法编辑，按照维基里教程直连又非常不稳定，因此希望申请IP封禁豁免权限，以便翻墙编辑。&#125;&#125;</code></li></ul><p>注意请用自己的话重新编写理由，直接粘贴本文内容有可能被拒。代码正确的话，下方会显示一个蓝色的申诉框，框内会显示你的申请理由，这是你的代码的实际展示效果。</p><p>操作完成后，点击下面的“添加话题”按钮，系统会提交数据。管理员看到你的申请之后，就会帮你审批并且授权，在此之前你需要耐心等待。</p><p>提交申诉后，注册账号的流程就结束了，你也可以重新开翻墙软件了。</p><h2 id="注册后注意事项">注册后注意事项</h2><p>新手一定要注意以下内容，以免辛辛苦苦注册出来的账号被管理员给封号。</p><h3 id="关于账号权限">关于账号权限</h3><ol type="1"><li>系统会自动取消不活跃用户的权限，当你失去这个权限之后，你挂梯子时又会被禁止编辑。系统的判断方法是距最后一次编辑时间满6个月，因此每6个月之内要至少做一笔编辑，内容随便。</li><li>系统会对新用户有一些限制，满50次编辑后解除，但是这50次最好是一些有意义的修改，例如修改词条里的错别字和语病，而且不要刷次数，否则容易被管理员封号。</li></ol><h3 id="关于词条编写">关于词条编写</h3><ol type="1"><li>维基百科的规则非常复杂，且中文维基百科对新用户不太友好，因此不要贸然去写新词条。最好先熟悉现有词条的编写风格，学习代码的语法，并且了解一些基本的规则，然后再模仿一些主题相似的内容来编写词条。</li><li>不要直接复制粘贴其他网站内容，否则会被管理员直接删掉，反复粘贴还会被封号。不过你可以稍微改改用词，换换语气，用自己的话来改写，这样就不算“侵权”了。</li><li>不要改变代码里的简繁体，如果代码里原来用的是繁体字，你把它改成了简体，或者反过来把简体字改成了繁体字，你也会被警告或封号。</li><li>维基百科对配图的要求又多又复杂，因此在熟悉规则之前，不要给词条配图（以及音视频素材），以免图片被删、账号被封。</li></ol><h3 id="关于中国政治">关于中国政治</h3><p>如果你不清楚翻墙之后的政治生态，或者认为翻墙之后（或翻墙之前）看到的内容是错误的，或者看到某类政治观点后情绪激动，那么请不要编辑政治方面的词条，更不要情绪激动地与其他用户辩论。这种情况管理员见得太多了，所以他们可能会直接封你的号。</p><p>如果你坚信翻墙之后看到的政治内容都是错误的，而且要坚持修正维基百科的内容，那么你的修改基本上会被其他地区的用户给改回去，而且你也很快会被管理员封号。这种情况下可以考虑去<span class="exturl" data-url="aHR0cHM6Ly9xaXV3ZW4ud2lraS8=">求闻百科<i class="fa fa-external-link-alt"></i></span>注册账号，这个不用翻墙，里面的政治内容已经被修正，而且其他知识和维基百科是基本一致的。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;span class=&quot;exturl&quot; data-url=&quot;aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3dpa2kvSGVscDolRTUlQTYlODIlRTQlQkQlOTUlRTglQUUlQkYlRTklOTclQUUlRTclQkIlQjQlRTUlOUYlQkElRTclOTklQkUlRTclQTclOTE=&quot;&gt;中文维基百科提供了官方的操作教程&lt;i class=&quot;fa fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;，但是教程出于多样性考虑，内容比较繁杂，而且对操作者的技术水平要求非常高，因此这里重新写一个简单可行的操作教程。&lt;/p&gt;</summary>
    
    
    
    <category term="教程" scheme="https://plusnan.me/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="维基百科" scheme="https://plusnan.me/tags/%E7%BB%B4%E5%9F%BA%E7%99%BE%E7%A7%91/"/>
    
  </entry>
  
  <entry>
    <title>在Java中运行ES6代码</title>
    <link href="https://plusnan.me/2023/05/10/javet/"/>
    <id>https://plusnan.me/2023/05/10/javet/</id>
    <published>2023-05-09T16:00:00.000Z</published>
    <updated>2024-03-04T01:02:26.815Z</updated>
    
    <content type="html"><![CDATA[<p>Java自带Nashorn引擎，可以在Java程序中运行JavaScript代码，从而<ahref="/2022/06/08/dynamic-controller">实现可灵活配置动态接口</a>。然而Nashorn引擎只支持老旧的语法，不支持ES6或更新的东西，而且在较新的Java中也已停止支持，因此本文选择替代品<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Nhb2NjYW8vSmF2ZXQ=">Javet<i class="fa fa-external-link-alt"></i></span>。</p><p>Javet是一个能够整合Java与Node.js的库，使开发人员可以很方便地调用ES6的代码。</p><span id="more"></span><h2 id="引入javet">引入Javet</h2><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Nhb2NjYW8vSmF2ZXQ=">官方仓库<i class="fa fa-external-link-alt"></i></span>指出了具体的方法。例如使用Maven时需要在pom.xml中加入：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- Linux and Windows (x86_64) --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.caoccao.javet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>javet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.1.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- Linux (arm64) --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.caoccao.javet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>javet-linux-arm64<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.1.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- Mac OS (x86_64 and arm64) --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.caoccao.javet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>javet-macos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.1.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="调用javascript代码">调用JavaScript代码</h2><h3 id="普通调用">普通调用</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">runJsCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> code<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JavetException</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Object</span> result <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">V8Runtime</span> v8Runtime <span class="token operator">=</span> <span class="token class-name">V8Host</span><span class="token punctuation">.</span><span class="token function">getV8Instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createV8Runtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">JavetProxyConverter</span> javetProxyConverter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JavetProxyConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        v8Runtime<span class="token punctuation">.</span><span class="token function">setConverter</span><span class="token punctuation">(</span>javetProxyConverter<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// TODO 可在这里引入Java对象，以便作为js的全局变量使用</span>        v8Runtime<span class="token punctuation">.</span><span class="token function">getGlobalObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"XXXUtil"</span><span class="token punctuation">,</span> xxxUtil<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">V8Value</span> val <span class="token operator">=</span> v8Runtime<span class="token punctuation">.</span><span class="token function">getExecutor</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        result <span class="token operator">=</span> <span class="token function">parseV8Value</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> result<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">private</span> <span class="token class-name">Object</span> <span class="token function">parseV8Value</span><span class="token punctuation">(</span><span class="token class-name">V8Value</span> val<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JavetException</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token keyword">instanceof</span> <span class="token class-name">V8ValueString</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">V8ValueString</span><span class="token punctuation">)</span> val<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token keyword">instanceof</span> <span class="token class-name">V8ValueBigInteger</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">V8ValueBigInteger</span><span class="token punctuation">)</span> val<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token keyword">instanceof</span> <span class="token class-name">V8ValueBoolean</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">V8ValueBoolean</span><span class="token punctuation">)</span> val<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token keyword">instanceof</span> <span class="token class-name">V8ValueDouble</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">V8ValueDouble</span><span class="token punctuation">)</span> val<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token keyword">instanceof</span> <span class="token class-name">V8ValueInteger</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">V8ValueInteger</span><span class="token punctuation">)</span> val<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token keyword">instanceof</span> <span class="token class-name">V8ValueLong</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">V8ValueLong</span><span class="token punctuation">)</span> val<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token keyword">instanceof</span> <span class="token class-name">V8ValueArray</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// TODO 根据需要进行处理</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">V8ValueArray</span><span class="token punctuation">)</span> val<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token keyword">instanceof</span> <span class="token class-name">V8ValueObject</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// TODO 根据需要进行处理</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">V8ValueObject</span><span class="token punctuation">)</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// TODO 根据需要进行处理</span>    <span class="token keyword">return</span> val<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用时调用<code>runJsCode("js代码")</code>即可，返回值为Java对象。但由于JS的数组和Object灵活性较强，本程序仍返回Javet的对象，编码时应考虑根据实际需求进行处理。</p><h3 id="将对象转为json">将对象转为JSON</h3><p>如果用于JSON，例如<ahref="/2022/06/08/dynamic-controller">配置动态接口</a>，将上述代码返回的对象直接转成JSON，结果可能会出错，因此需要在转JSON之前做一些加工处理。</p><p>为便于处理JSON，下面引入了Hutool，因此需要在pom.xml中引入：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>cn.hutool<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>hutool-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>5.6.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面代码的runJsCode不变，对parseV8Value进行修改，替换成下面的代码：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token class-name">Object</span> <span class="token function">parseV8Value</span><span class="token punctuation">(</span><span class="token class-name">V8Value</span> val<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JavetException</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">V8Scope</span> v8Scope <span class="token operator">=</span> val<span class="token punctuation">.</span><span class="token function">getV8Runtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getV8Scope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        v8Scope<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>        val <span class="token operator">=</span> <span class="token function">parseV8ValueToBasic</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> v8Scope<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token keyword">instanceof</span> <span class="token class-name">V8ValueString</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">V8ValueString</span><span class="token punctuation">)</span> val<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token keyword">instanceof</span> <span class="token class-name">V8ValueBigInteger</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">V8ValueBigInteger</span><span class="token punctuation">)</span> val<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token keyword">instanceof</span> <span class="token class-name">V8ValueBoolean</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">V8ValueBoolean</span><span class="token punctuation">)</span> val<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token keyword">instanceof</span> <span class="token class-name">V8ValueDouble</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Double</span> d <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">V8ValueDouble</span><span class="token punctuation">)</span> val<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 无穷大和NaN转JSON会报错，这里直接返回null</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>d<span class="token punctuation">.</span><span class="token function">isInfinite</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> d<span class="token punctuation">.</span><span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                d <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">return</span> d<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token keyword">instanceof</span> <span class="token class-name">V8ValueInteger</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">V8ValueInteger</span><span class="token punctuation">)</span> val<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token keyword">instanceof</span> <span class="token class-name">V8ValueLong</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">V8ValueLong</span><span class="token punctuation">)</span> val<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token keyword">instanceof</span> <span class="token class-name">V8ValueArray</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> json <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">V8ValueArray</span><span class="token punctuation">)</span> val<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toJsonString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>json <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"TypeError"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">return</span> <span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">parseArray</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token keyword">instanceof</span> <span class="token class-name">V8ValueTypedArray</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> json <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">V8ValueTypedArray</span><span class="token punctuation">)</span> val<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toJsonString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>json <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"TypeError"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">return</span> <span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">parseObj</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token keyword">instanceof</span> <span class="token class-name">V8ValueObject</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> json <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">V8ValueObject</span><span class="token punctuation">)</span> val<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toJsonString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>json <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"TypeError"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">return</span> <span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">parseObj</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// 其他类型无法转成JSON，直接返回null</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">private</span> <span class="token class-name">V8Value</span> <span class="token function">parseV8ValueToBasic</span><span class="token punctuation">(</span><span class="token class-name">V8Value</span> val<span class="token punctuation">,</span> <span class="token class-name">V8Scope</span> v8Scope<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JavetException</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token keyword">instanceof</span> <span class="token class-name">V8ValueString</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> val<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token keyword">instanceof</span> <span class="token class-name">V8ValueBigInteger</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> val<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token keyword">instanceof</span> <span class="token class-name">V8ValueBoolean</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> val<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token keyword">instanceof</span> <span class="token class-name">V8ValueDouble</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> val<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token keyword">instanceof</span> <span class="token class-name">V8ValueInteger</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> val<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token keyword">instanceof</span> <span class="token class-name">V8ValueLong</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 处理js中Number与Java中Double的差异</span>        <span class="token class-name">Long</span> u <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">V8ValueLong</span><span class="token punctuation">)</span> val<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>u <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> v8Scope<span class="token punctuation">.</span><span class="token function">createV8ValueNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">long</span> v <span class="token operator">=</span> u<span class="token punctuation">.</span><span class="token function">longValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>v <span class="token operator">&lt;=</span> <span class="token number">9007199254740991L</span> <span class="token operator">&amp;&amp;</span> v <span class="token operator">>=</span> <span class="token operator">-</span><span class="token number">9007199254740991L</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> v8Scope<span class="token punctuation">.</span><span class="token function">createV8ValueDouble</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> val<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token keyword">instanceof</span> <span class="token class-name">V8ValueProxy</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 将Java对象实例变成JS对象，进而方便转JSON</span>        <span class="token class-name">V8ValueProxy</span> proxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">V8ValueProxy</span><span class="token punctuation">)</span> val<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>proxy<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">"getClass"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> proxy<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">"hashCode"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> proxy<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">"equals"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> proxy<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">"toString"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> proxy<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">"notify"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> proxy<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">"notifyAll"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> proxy<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">"wait"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">V8ValueObject</span> v8ValueObject <span class="token operator">=</span> v8Scope<span class="token punctuation">.</span><span class="token function">createV8ValueObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Class</span> clz <span class="token operator">=</span> proxy<span class="token punctuation">.</span><span class="token function">invokeObject</span><span class="token punctuation">(</span><span class="token string">"getClass"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 获取对象的getter并进行调用</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Method</span> method <span class="token operator">:</span> clz<span class="token punctuation">.</span><span class="token function">getMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getParameterCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token class-name">Modifier</span><span class="token punctuation">.</span><span class="token function">isStatic</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getModifiers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">String</span> methodName <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">String</span> propertyName <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>methodName<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token constant">METHOD_PREFIX_IS</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token constant">EXCLUDED_METHODS</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>methodName<span class="token punctuation">)</span>                            <span class="token operator">&amp;&amp;</span> methodName<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token constant">METHOD_PREFIX_IS</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        propertyName <span class="token operator">=</span> methodName<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token constant">METHOD_PREFIX_IS</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">METHOD_PREFIX_IS</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token constant">ROOT</span><span class="token punctuation">)</span>                                <span class="token operator">+</span> methodName<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token constant">METHOD_PREFIX_IS</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>methodName<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token constant">METHOD_PREFIX_GET</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token constant">EXCLUDED_METHODS</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>methodName<span class="token punctuation">)</span>                            <span class="token operator">&amp;&amp;</span> methodName<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token constant">METHOD_PREFIX_GET</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        propertyName <span class="token operator">=</span> methodName<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token constant">METHOD_PREFIX_GET</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">METHOD_PREFIX_GET</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token constant">ROOT</span><span class="token punctuation">)</span>                                <span class="token operator">+</span> methodName<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token constant">METHOD_PREFIX_GET</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>propertyName <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token class-name">V8Value</span> newVal <span class="token operator">=</span> proxy<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>methodName<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>newVal <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                            v8Scope<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>newVal<span class="token punctuation">)</span><span class="token punctuation">;</span>                            newVal <span class="token operator">=</span> <span class="token function">parseV8ValueToBasic</span><span class="token punctuation">(</span>newVal<span class="token punctuation">,</span> v8Scope<span class="token punctuation">)</span><span class="token punctuation">;</span>                            v8ValueObject<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>propertyName<span class="token punctuation">,</span> newVal<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">return</span> v8ValueObject<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token keyword">instanceof</span> <span class="token class-name">V8ValueArray</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">V8ValueArray</span> arr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">V8ValueArray</span><span class="token punctuation">)</span> val<span class="token punctuation">;</span>        <span class="token comment">// 递归处理每个元素</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">V8Value</span> u <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">V8Value</span> v <span class="token operator">=</span> <span class="token function">parseV8ValueToBasic</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> v8Scope<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>u <span class="token operator">!=</span> v<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                arr<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> arr<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token keyword">instanceof</span> <span class="token class-name">V8ValueTypedArray</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">V8ValueTypedArray</span> arr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">V8ValueTypedArray</span><span class="token punctuation">)</span> val<span class="token punctuation">;</span>        <span class="token class-name">V8ValueArray</span> arr2 <span class="token operator">=</span> v8Scope<span class="token punctuation">.</span><span class="token function">createV8ValueArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 递归处理每个元素</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">V8Value</span> u <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">V8Value</span> v <span class="token operator">=</span> <span class="token function">parseV8ValueToBasic</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> v8Scope<span class="token punctuation">)</span><span class="token punctuation">;</span>            arr2<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> arr2<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token keyword">instanceof</span> <span class="token class-name">V8ValueObject</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">V8ValueObject</span> obj <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">V8ValueObject</span><span class="token punctuation">)</span> val<span class="token punctuation">;</span>        <span class="token comment">// 递归处理每个元素</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> key <span class="token operator">:</span> obj<span class="token punctuation">.</span><span class="token function">getOwnPropertyNameStrings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">V8Value</span> u <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">V8Value</span> v <span class="token operator">=</span> <span class="token function">parseV8ValueToBasic</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> v8Scope<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>u <span class="token operator">!=</span> v<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                obj<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> obj<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// 其他类型（例如Function）无法转成JSON，直接返回null</span>    <span class="token keyword">return</span> v8Scope<span class="token punctuation">.</span><span class="token function">createV8ValueNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上代码还有一些缺陷，例如Java对象不是VO类型的类，转换时候就会出问题，不过现在的代码对于转JSON这种需求来说够用了。</p><h2 id="docker报错处理">Docker报错处理</h2><p>如果将应用部署到Docker中，代码可能会无法正常执行：</p><pre class="line-numbers language-none"><code class="language-none">com.caoccao.javet.exceptions.JavetException: Javet library is not loaded because &lt;null&gt;    at com.caoccao.javet.interop.JavetClassLoader.load(JavetClassLoader.java:93)    at com.caoccao.javet.interop.V8Host.loadLibrary(V8Host.java:418)    at com.caoccao.javet.interop.V8Host.&lt;init&gt;(V8Host.java:67)    at com.caoccao.javet.interop.V8Host.&lt;init&gt;(V8Host.java:43)    at com.caoccao.javet.interop.V8Host$V8InstanceHolder.&lt;clinit&gt;(V8Host.java:459)    at com.caoccao.javet.interop.V8Host.getV8Instance(V8Host.java:119)    ……Caused by: java.lang.reflect.InvocationTargetException    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)    at java.lang.reflect.Method.invoke(Method.java:498)    at com.caoccao.javet.interop.JavetClassLoader.load(JavetClassLoader.java:88)    ... 170 moreCaused by: com.caoccao.javet.exceptions.JavetException: Failed to read &#x2F;tmp&#x2F;javet&#x2F;1&#x2F;libjavet-v8-linux-x86_64.v.3.0.1.so    at com.caoccao.javet.interop.loader.JavetLibLoader.load(JavetLibLoader.java:375)    ... 175 moreCaused by: java.lang.UnsatisfiedLinkError: &#x2F;tmp&#x2F;javet&#x2F;1&#x2F;libjavet-v8-linux-x86_64.v.3.0.1.so: &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6: version &#96;GLIBC_2.33&#39; not found (required by &#x2F;tmp&#x2F;javet&#x2F;1&#x2F;libjavet-v8-linux-x86_64.v.3.0.1.so)    at java.lang.ClassLoader$NativeLibrary.load(Native Method)    at java.lang.ClassLoader.loadLibrary0(ClassLoader.java:1934)    at java.lang.ClassLoader.loadLibrary(ClassLoader.java:1817)    at java.lang.Runtime.load0(Runtime.java:810)    at java.lang.System.load(System.java:1088)    at com.caoccao.javet.interop.loader.JavetLibLoader.load(JavetLibLoader.java:360)    ... 175 more<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这是因为选择了alpine或slim版本的映像，容器里面缺少glibc，因此需要将image换成完整版，例如<code>openjdk:8</code>。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;Java自带Nashorn引擎，可以在Java程序中运行JavaScript代码，从而&lt;a
href=&quot;/2022/06/08/dynamic-controller&quot;&gt;实现可灵活配置动态接口&lt;/a&gt;。然而Nashorn引擎只支持老旧的语法，不支持ES6或更新的东西，而且在较新的Java中也已停止支持，因此本文选择替代品&lt;span class=&quot;exturl&quot; data-url=&quot;aHR0cHM6Ly9naXRodWIuY29tL2Nhb2NjYW8vSmF2ZXQ=&quot;&gt;Javet&lt;i class=&quot;fa fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;。&lt;/p&gt;
&lt;p&gt;Javet是一个能够整合Java与Node.js的库，使开发人员可以很方便地调用ES6的代码。&lt;/p&gt;</summary>
    
    
    
    <category term="记录" scheme="https://plusnan.me/categories/%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="Java" scheme="https://plusnan.me/tags/Java/"/>
    
    <category term="Javet" scheme="https://plusnan.me/tags/Javet/"/>
    
    <category term="JavaScript" scheme="https://plusnan.me/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>对汽车“价格战”的一点看法</title>
    <link href="https://plusnan.me/2023/04/01/is-price-war-real/"/>
    <id>https://plusnan.me/2023/04/01/is-price-war-real/</id>
    <published>2023-03-31T16:00:00.000Z</published>
    <updated>2024-03-11T08:41:42.889Z</updated>
    
    <content type="html"><![CDATA[<p>今年3月份，从东风雪铁龙C6补贴9万开始，汽车市场仿佛开始了“价格战”。然而，汽车真的便宜了吗？</p><p><strong>本文纯属个人见解，与当下事件无关，如有雷同，纯属巧合。</strong></p><span id="more"></span><h2 id="关于雪铁龙降9万">关于雪铁龙降9万</h2><p>哇塞，优惠居然这么大！是真的吗？</p><p>是的，但是，如果你不熟悉汽车，可以去大街上留意一下：雪铁龙的车标是两个尖（类似︽符号），可是大街上有几辆带两个尖的车呢？在这些车里面，又有几辆是新车呢？</p><p>雪铁龙本来就是没什么人买的车（新车），再加上一下子降了最高9万（实际可能不到9万），可能是因为什么原因根本没卖出去的车。这种车不可能太多的，当然售完为止。其他法系车例如标致同理。</p><p>另外某些商家有一种操作方法，说什么东西大幅降价，当你过去买的时候，“卖没了，看看别的吧”，其实根本没卖过，只是一种引流策略而已。</p><p>后续：<span class="exturl" data-url="aHR0cHM6Ly9tLnlpY2FpLmNvbS9uZXdzLzEwMTc5OTY1My5odG1s">车主需全款买车，然而补贴一直没有到位<i class="fa fa-external-link-alt"></i></span></p><h2 id="关于20万买奥迪">关于20万买奥迪</h2><p>奥迪给人的印象是豪车。如今豪车已经卖不动，居然用20万就能搞定？</p><p>当然了！但是，奥迪A3，加上做汽车金融操作。</p><p>奥迪A3是什么？是奥迪里面配置最低的车型，俗称“乞丐车”，跟一般人眼里的奥迪A6、A8完全不是一个档次，甚至不如同样容易遭歧视的奥迪A4（落地价大约30左右）。就算你把车屁股上的A3字样抠掉，再贴个quattro，稍有常识的人都会看出，这只是辆想装大款的乞丐A3。</p><p>汽车金融是什么？分期，贷款。由于贷款或分期，4S店能挣到提成，而全款挣不到提成，所以很多4S店会对全款买车的车主表示反感，甚至分期买车的最后给你举办个隆重的交车仪式，而全款买车的完事了直接让你滚蛋，连根红绳都不给。然而选择贷款或分期，车辆名义上的价格下降了，但实际花销会比全款高。</p><p>想用20万搞定四个圈的A6 55quattro（高配车型，落地大约55万）？还是去二手市场找找八手车吧！</p><h2 id="关于大幅优惠大幅让利">关于大幅优惠、大幅让利</h2><p>没买过车的，看到“终端优惠4万”，会觉得厂商让利很大。但是真的很大吗？</p><p>所以我们一定要先了解汽车的各种价格的概念：</p><ul><li>裸车价：裸车价是由4S店开出的价格，是汽车本身的价格。然而只买车，车是不能挂牌上路的，所以还需要一系列税费和手续费。</li><li>落地价：落地价是<strong>你的真实花销</strong>，落地价=裸车价+购置税+保险费用+各种其他费用。鉴于一般群众买不起豪车，如果你懒得计算，可以粗暴地认为落地价=裸车价+2～3万。</li><li>指导价：由厂商提出的售价，非真实价格。</li><li>优惠：优惠是4S店在指导价基础上做出的优惠。</li></ul><p>需要注意的是，虽然官方有指导价，但是4S店根本不会按指导价来卖车，而是平时就会降几万块钱来卖，所以就算他们提出了所谓的“优惠”，也是在指导价上面做的优惠，实际上还是相当于没有优惠。</p><p>还需要注意一种情况，有的汽车真的降价了，但是同一型号有高中低配置版本之分，他们给低配降得多，中高配降得少或几乎不降。你以为捡到了便宜，却发现低配功能不够用，想要开得舒服，还是需要买中高配，结果会导致想省钱的开着难受，想舒服的实际上根本没省几个钱。</p><p>对于大众、本田这种根本不愁卖不出去的品牌，其实他们完全没有必要去降价。但是，为了做出因为“价格战”优惠的感觉，4S可以调整指导价，然后再调整终端优惠和一系列“工时费”，让你以为便宜了不少，然而落地价还是那么多。如果你能回到过去，你会发现“价格战”前后落地价都是一个样子。</p><p>2022年因为疫情影响经济，出台了购置税减半的政策。那么当时买能省钱吗？并没有！只要4S店稍微做一些操作，就可以让你感觉到自己享受到了国家的优惠，然而落地价却一分都没少。</p><h2 id="所以">所以……</h2><p>需要买车的，该买就买，可以稍微等等出新款之前4S店便宜处理的旧款库存车，但是没必要特意等“价格战”；</p><p>不需要买车的，别因为出现所谓的“利好”政策，或者发生所谓的“价格战”就草率入场，也许车市有“崩”的迹象，但是车价并没有真的变便宜。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;今年3月份，从东风雪铁龙C6补贴9万开始，汽车市场仿佛开始了“价格战”。然而，汽车真的便宜了吗？&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;本文纯属个人见解，与当下事件无关，如有雷同，纯属巧合。&lt;/strong&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="闲谈" scheme="https://plusnan.me/categories/%E9%97%B2%E8%B0%88/"/>
    
    
  </entry>
  
  <entry>
    <title>学习反向思考</title>
    <link href="https://plusnan.me/2023/03/12/reverse-thinking/"/>
    <id>https://plusnan.me/2023/03/12/reverse-thinking/</id>
    <published>2023-03-11T16:00:00.000Z</published>
    <updated>2024-03-05T13:24:37.264Z</updated>
    
    <content type="html"><![CDATA[<p>很多事情是反直觉的：你觉得可能是这样，但情况可能是另一个样子。本文用最近的几个例子来说明一下。</p><span id="more"></span><h2 id="说明">说明</h2><p>本文希望读者去掌握一种思维模式，所以着重于指出一种“可能性”，不代表观点正确或错误，正所谓“大胆思考，小心论证”。</p><h2 id="案例一居民存款大幅增加">案例一：居民存款大幅增加</h2><p>中国央行2023年1月份数据指出，当月人民币存款增加6.87万亿元，其中住户存款增加6.2万亿元，创历史同期新高。</p><p>居民存款大幅增加，是因为大家都挣到钱，收入提高了吗？很明显，经过疫情冲击，很多人收入下降，甚至失去收入，都不敢花钱了，所以大家都在储蓄，使得存款增加。</p><p>接下来，我们再稍微思考一下：只是不花钱，存款能大幅增加吗？</p><p>存款是怎么来的呢？挣钱了，把钱存下来，就有了存款。</p><p>然而存款只是财产的一种形式，如果把其他形式的资产变成存款，存款也是能增加的，例如抛售股票、赎回理财产品等。贷款套现也能增加存款，只是将来要把钱连同利息一起还回去而已。</p><h2 id="案例二平均工资提高">案例二：平均工资提高</h2><p>根据国家统计局发布的数据，2022年，全国城镇非私营单位就业人员年平均工资为114029元，比上年增加7192元，名义增长6.7%，增速比上年回落3个百分点，扣除价格因素实际增长4.6％。</p><p>平均工资提高，真的是因为大家收入提高了吗？为什么只有我拖了平均值后腿呢？</p><p>我们稍微思考一下，平均工资是怎样计算的。</p><p>假设有100个人，其中90个穷光蛋，每月收入1000块钱，剩下10个有钱人，每月收入100000元，那么他们的平均收入就是</p><p><span class="math display">\[ \frac{1000 \times 90 + 100000 \times10}{100} = 10900 \]</span></p><p>假如这90个穷光蛋中有30人失业了，剩下的穷光蛋每月收入降低到900元，有钱人们虽然没丢掉工作，但是统统降了薪，收入降到了80000元，那么他们的平均收入就变成了</p><p><span class="math display">\[ \frac{900 \times (90 - 30) + 80000\times 10}{100 - 30} = 12200 \]</span></p><p>你看，虽然大家都没挣到钱，但是大家的平均工资竟然提高了 <spanclass="math inline">\(\frac{12200 - 10900}{10900} = 11.9\%\)</span>！</p><h2 id="案例三国产新能源车畅销">案例三：国产新能源车畅销</h2><p>2022年，国产新能源汽车交付数量创下纪录，其中的头部品牌甚至被称为“新势力”。</p><p>我们去汽车网站上搜索一下“新势力”的代表，“蔚小理”（蔚来、小鹏、理想），可以发现这些品牌的汽车价格多在三四十万级别。</p><p>30万的车，5成首付、贷款两年的话，月供要超过6000元。加上房贷的话，实际月供甚至要超过上万元。这些昂贵的车也能畅销，是因为大家都有钱，或者敢贷款吗？</p><p>我们稍微思考一下，如果不是大家有钱了，而是大家没钱了呢？</p><p>假如我们为了装逼而买车，当然会挑豪华品牌，例如上百万的保时捷、玛莎拉蒂。没有那么多钱，所以才挑几十万的进口版的奥迪、奔驰、宝马。再没钱，就只好找稍微便宜一些的国产版，或者换雷克萨斯、凯迪拉克之类的二线豪华品牌了。再没钱，还可以二手车甚至带魂环的车。</p><p>近些年收入不好，买40多万的奔驰GLC，再加上每个月上千块的油钱，感觉稍微有点吃力，但是国产电车配置比奔驰高，开出去又有面，关键是比奔驰有性价比，为什么不买呢？</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;很多事情是反直觉的：你觉得可能是这样，但情况可能是另一个样子。本文用最近的几个例子来说明一下。&lt;/p&gt;</summary>
    
    
    
    <category term="闲谈" scheme="https://plusnan.me/categories/%E9%97%B2%E8%B0%88/"/>
    
    
    <category term="思考" scheme="https://plusnan.me/tags/%E6%80%9D%E8%80%83/"/>
    
  </entry>
  
  <entry>
    <title>科普文：家庭应急储备之对讲机</title>
    <link href="https://plusnan.me/2023/02/16/emergency-walkie-talkie/"/>
    <id>https://plusnan.me/2023/02/16/emergency-walkie-talkie/</id>
    <published>2023-02-15T16:00:00.000Z</published>
    <updated>2024-03-08T01:20:49.137Z</updated>
    
    <content type="html"><![CDATA[<p>对讲机，看起来是个很简单的东西，但是，自从考了业余无线电操作证之后，才会意识到，对讲机不仅要考证，而且还有很多讲究。本文讲一讲，当家庭为了应急储备而购买对讲机时，需要考虑什么事情。</p><span id="more"></span><h1 id="对讲机的作用">对讲机的作用</h1><p>如今4G、5G网络已经全面普及，使用手机就能很容易与人联络。然而，在手机信号不好的山区，或者在发生大型灾难时（例如汶川地震、郑州洪水），手机有可能收不到信号，这时如果有对讲机，就有更大的机会与人取得联络，了解所在地情况，或者发出求救信号。</p><h1 id="对讲机的种类">对讲机的种类</h1><p>在购买对讲机时，要先了解对讲机的种类，以免买错无法使用。</p><h2 id="公众对讲机">公众对讲机</h2><p>公众对讲机是开放给公众使用的对讲机，频率在409MHz附近，发射功率0.5W，覆盖范围比较近。频率不能调整，而且不能更换天线。但是这种对讲机既不需要考操作证，也不需要办理执照。</p><p>如果联络范围不大（1公里），而且仅限于熟人间联系，可考虑配置一对公众对讲机。</p><h2 id="业余对讲机">业余对讲机</h2><p>相比于公众对讲机，这里更推荐业余对讲机，因为“业余”对讲机更加“专业”。</p><p>“业余对讲机”，其中“业余”不是指操作水平业余，而是指用途业余，也就是给无线电爱好者提供的、非工作用途的对讲机。这类对讲机可以手工设置频率，发射功率比较大，而且可以通过更换天线来改善信号质量，所以灵活性比较高，覆盖范围也比较广。</p><p>业余的核准频率是144-148MHz（VHF段）以及430-440MHz（UHF段），发射功率可以到达5W甚至更高。430-440MHz在城市传播较好，因此也被无线电爱好者广泛使用。另外，在购买对讲机之前，需要确认它的发射与接收的频率范围，范围不同则无法互相通话。</p><p>按信号类型，对讲机可分为模拟信号和数字信号。由于数字信号使用人数较少，而且数字机价格较贵、操作复杂，不建议家庭购买。后文也将按照模拟信号来讲解。</p><p>为了提高可玩性，很多对讲机都有操作屏幕，能够进行一系列灵活操作，有些还支持双守模式，即同时收听两个频道。但是，对于你的家庭成员来说，这些操作可能过于复杂了，因此建议考虑买那种简单的机器：没有屏幕，没有设置，只有音量旋钮、频道旋钮和一个PTT按钮。这样的话，你就可以告诉你的家人，在发生什么情况，把机器调到几频道，然后就可以通话了。至于频率等参数，你可以事先用配套的软件来设置好。</p><p>使用业余对讲机需要考取业余无线电台操作证书，而且需要在获得操作证之后办理电台执照，取得一个电台呼号，这样才算是合法使用。然而实际情况是一般人根本不知道对讲机需要办证，很多行业例如工地塔吊在大量滥用业余对讲机，而且只要未对其他业务造成干扰，就几乎没人管。所以建议一方面大家把操作证考出来，用合法呼号来合法通联，另一方面又不要把合法性问题太当回事。</p><h2 id="公网对讲机">公网对讲机</h2><p>公网对讲机，就是利用4G/5G网络来进行联络的对讲机，因此公网对讲机可以有着比其他对讲机还要大的覆盖范围。</p><p>然而，这也说明了公网对讲机会像手机一样有流量费，而且当手机没信号时，公网对讲机也会失效，因此不适合应急使用。</p><h2 id="专业对讲机">专业对讲机</h2><p>专业对讲机通常用于特定行业，例如铁路、航空、海事、公安、军事等。有些对讲机是模拟信号，有些则是数字信号。但是，它们的频率都是行业专用频率，有些领域还是加密通信，普通人使用会被视为干扰，而且涉嫌违法，因此不要购买。</p><h1 id="对讲机设置">对讲机设置</h1><p>公众对讲机比较简单，只要两个人使用同一频道，信号相通，就能直接使用了。</p><p>但是业余对讲机比较复杂，特别是不同渠道、不同品牌、不同型号，需要进行一些设置，才能正常通话。</p><h2 id="寻找频率">寻找频率</h2><p>对讲机至少要保存两种频率：一种是直频频率，另一种是中继台频率。前者可以理解为私聊，后者可以理解为加群。</p><p>中继台频率可以在微信小程序“业余无线电”中进行搜索，找到“中继查询”功能，然后查询自己家附近的中继台频率。</p><p>关于直频频率，只规定了频率范围在多少MHz以内，但是并没有规定说你必须用多少MHz，所以只要符合频率范围，而且不会干扰他人，这样就行了。如果不确定，可以先将对讲机设置为特定频率，然后听一段时间，假如一直没人说话，有可能是没人占用。</p><h2 id="设置频率">设置频率</h2><p>下面讲述设置对讲机时需要注意的参数，具体设置方法则需要查看对讲机的说明书。</p><h3 id="中继频率">中继频率</h3><p>在查询中继后，要留意一些参数：模式、频率、频差、亚音，你需要找到对讲机说明书，并找到相应的参数设置来设置对讲机：</p><ul><li>模式：要选择模拟模式，或数模混合模式的中继。如果只支持数字模式，那么可以直接略过，因为模拟信号对讲机连接不上。</li><li>频率：假如中继台频率是439.150MHz，你需要将对讲机设置为频率模式，然后输入439.150。</li><li>频差：假如频差是下差5MHz（减5MHz），需要找到类似“频差方向”、“频差频率”之类的设置，将频差方向设置为“-”，频差频率设置为5MHz。上差则是把频差方向设置为“+”。没有频差（直频）则需要把频差方向设置为“关闭”或“OFF”。</li><li>亚音：亚音分为发送亚音（编码亚音，T-CTCSS）和接收亚音（解码亚音，R-CTCSS）。需要将相应亚音设置为中继参数中的亚音，否则中继不会接收你的语音。</li></ul><p>设置完成后，你可以将其保存为频道，下次使用时，进入频道模式，切换到相应频道，对讲机会自动设置这些参数，你就不需要重复设置了。</p><p>如果对讲机有“消除尾音”或类似功能，你需要将其关闭，以便验证参数设置是否正确。操作完成后，找一个信号传播比较好的位置，例如楼顶天台，按一下发射键，然后立刻松开，如果能听到一声回响，说明信号能够打到中继。</p><h3 id="直频频率">直频频率</h3><p>直频频率，进入频率模式，直接录入频率数字即可使用。有时你设置中继频率之后，频差、亚音等设置会留在对讲机内，所以不要忘记将这些设置清除。</p><p>为操作方便，可在清除设置后，再把录入的频率保存成频道，下次使用时，直接切换到频道模式，对讲机会自动清除无关设置。</p><p>除自选频率外，还可以再保存一个438.500MHz，很多无线电爱好者会将其视为测试或应急频率。如果发生紧急情况，并在此频道呼叫，可能会有更多机让人听到。</p><h2 id="写频">写频</h2><p>很多对讲机支持软件写频，也就是在电脑上进行操作，把频率设置到对讲机里面。如果是没有屏幕的机器，那么你还不得不使用写频软件来设置频率。</p><p>因此在购买对讲机之前，你需要询问：</p><ol type="1"><li>是否支持软件写频</li><li>是否需要专门的写频线，写频线是否需要驱动，驱动是否支持你的电脑系统</li><li>写频软件的下载方式，以及是否支持你的电脑系统</li><li>写频软件的操作方法</li></ol><h1 id="注意事项">注意事项</h1><h2 id="数量">数量</h2><p>对讲机至少要买两台才能使用，其品牌型号可以不一样，但是信号类型要一致（模拟机），而且频率一定要有交集。</p><h2 id="合法性">合法性</h2><p>如果没有合法呼号，不要随意与中继台通话，否则别人不会理你，或者会教育你去考证办证。</p><p>如果当地中继台允许小号，可与当地中继台进行联系，加入当地组织并申请小号。但是小号并不通用，有些中继也不承认小号，所以要注意通信范围。</p><h2 id="干扰">干扰</h2><p>同一频率只能有一个人说话，如果频道内有人正在说话，那么不要按发射键，否则会干扰现有通话。</p><p>在设置频率时，有些频率不要随意占用：</p><ol type="1"><li>144～144.035MHz和145.8～146MHz</li><li>431.9～432.240MHz和435～438MHz</li><li>144.640MHz：很多无线电爱好者会当作定位频率（APRS）使用</li><li>438.500MHz：很多无线电爱好者会当作应急频率使用</li><li>当地或附近城市的中继台的频率</li><li>超出144～148MHz、430～440MHz范围的其他频率</li></ol><p>频率的影响范围通常是±25kHz（±0.025MHz），例如被要求不要占用438.500MHz，那么你不要在438.475~438.525MHz范围进行发射。</p><p>中继台通常会有频差，假如中继台频率439.000MHz，下差5MHz，那么439.000MHz与434.000MHz（439减5）附近±25kHz的频率都不要随意占用。</p><h2 id="私密性">私密性</h2><p>对讲机通话没有任何加密，即使不知道频率，其他人也很容易找到频率并进行偷听。因此在通话期间不要暴露隐私：</p><ul><li>给每位家庭成员起一个代号，使用代号通话。</li><li>不要谈论财产、联系方式、账号密码、精确位置等敏感信息。</li><li>在平时考虑给一些敏感事项起代号，而且确保第三者听不懂、猜不到，一旦遇到紧急情况，而且不得不提及敏感事项，使用代号来谈论。</li></ul><h2 id="覆盖范围">覆盖范围</h2><p>对讲机的覆盖范围并不是一个绝对的数字，主要取决于它的位置。简单来说，在楼房密集地方不如在开阔地，在地面不如在楼上，在屋内不如在窗户边，在窗户边不如在楼顶，在楼顶不如在更高的山顶。对于专业的业余无线电爱好者，配置特定的天线，只需一个瓦特，甚至可以从地球打到卫星。</p><p>对讲机要竖立使用，不要放倒，否则会影响传播。而且对讲机必须安装天线，否则不仅无法传播信号，还会把对讲机烧坏。</p><p>建议平时进行信号测试，有机会还可以考虑在相同位置、不同天气条件下进一步测试，了解哪种情况的传播效果比较好。</p><h2 id="充电">充电</h2><p>对讲机要定期充电，以免过度亏电，在发生紧急情况时无法使用。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;对讲机，看起来是个很简单的东西，但是，自从考了业余无线电操作证之后，才会意识到，对讲机不仅要考证，而且还有很多讲究。本文讲一讲，当家庭为了应急储备而购买对讲机时，需要考虑什么事情。&lt;/p&gt;</summary>
    
    
    
    <category term="教程" scheme="https://plusnan.me/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="应急储备" scheme="https://plusnan.me/tags/%E5%BA%94%E6%80%A5%E5%82%A8%E5%A4%87/"/>
    
    <category term="对讲机" scheme="https://plusnan.me/tags/%E5%AF%B9%E8%AE%B2%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>2023新年注意事项</title>
    <link href="https://plusnan.me/2023/01/20/new-year/"/>
    <id>https://plusnan.me/2023/01/20/new-year/</id>
    <published>2023-01-19T16:00:00.000Z</published>
    <updated>2024-03-01T09:23:56.544Z</updated>
    
    <content type="html"><![CDATA[<p>疫情结束了，可是疫情还有后遗症，不仅对个人身体有影响，对经济环境也会有影响。作为普通人，在新的一年里，我们还要注意什么呢？</p><span id="more"></span><h1 id="声明">声明</h1><p><strong>本文仅供参考，不作为投资理财建议。</strong></p><h1 id="不要随便折腾">不要随便折腾</h1><p>疫情期间，由于不断地封城，经济受到了很大冲击，最终导致很多人降薪失业。</p><p>尽管疫情结束了，经济看起来即将复苏，但是毕竟复苏还尚未实现，加上中国的经济的确存在一些根本性的问题，因此现在不要急着折腾。</p><p>具体来讲：</p><ul><li>选择保守策略，假如年底形势好转，再调整决策</li><li>不要随意辞职，不要随意跳槽</li><li>不要创业</li><li>不要加杠杆（增加借贷）</li><li>在涉及个人利益的问题上，不要碰自己不熟悉的东西</li></ul><p>很多人会担心财产贬值，所以想做些什么事情，可是你会发现，如果你什么都不做，你甚至可能跑赢80%的投资者。</p><h1 id="守好自己财产">守好自己财产</h1><h2 id="避免投资">避免投资</h2><p>尽量用最保守的投资方式来投资，即银行存款。同时，银行存款要分散放在大银行中，不要放在小银行中，例如地方银行、城商行、农商行甚至村镇银行，<span class="exturl" data-url="aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3dpa2kvMjAyMiVFNSVCOSVCNCVFNiVCMiVCMyVFNSU4RCU5NyVFNSVBNCU5QSVFNSVBRSVCNiVFNiU5RCU5MSVFOSU5NSU4NyVFOSU5MyVCNiVFOCVBMSU4QyVFNSVCQyU4QSVFNiVBMSU4OA==">河南村镇银行事件<i class="fa fa-external-link-alt"></i></span>提醒我们，未来小银行很可能要出事，而且你损失的将不仅仅是存款。</p><p>目前很多地区网民都在反馈自己的银行卡被无故限制、无故冻结，而且申诉困难，所以家中要预备满足一个月生活需求的现金，这样在跟银行扯皮期间至少还有钱花，不至于沦落到需要找人借钱或者出门讨饭的程度。</p><h2 id="防范诈骗">防范诈骗</h2><p>由于越来越多的人失去收入，未来会有越来越多的人走上犯罪的道路，包括盗窃、抢劫和诈骗。</p><p>虽然现在治安好了，监控多了，但是大家不要以为就一定安全了。警察也不可能保证每个案子都能管得到，特别是如果犯罪者跑到国外去了，警察就算查到了痕迹，也很难追回损失，所以大家要更加提高警惕。</p><p>防范诈骗的方法很简单：现在大家都自顾不暇，不可能还要给你好处，所以能够给你好处的，都是骗子。</p><h2 id="及时止损">及时止损</h2><p>如果你有借贷，而且手有余钱，因为投资的收益可能还不如贷款利息高，所以可考虑提前还款，降低损失。</p><p>如果你在股市、基金、房地产等领域有投资，建议及时退出，及时止损。房地产未来看人口，而人口总体是下降的，这意味着房地产，特别是低线城市的房地产将越来越不值钱。你现在已经挣不到钱了，但是及时出清，至少你的损失会比将来更小。</p><p>如果你现在不愿处置财产，你可以稍微等一阵子，等行情见涨之后，见好就收，马上退出。</p><h1 id="避免与人矛盾">避免与人矛盾</h1><p>疫情三年，很多人因为长期封闭，加上收入不如以往，生活不断受冲击，各种压力程度大增，心理状态已经不正常，甚至已经产生了心理疾病，这导致社会的极端事件也不断增多，甚至出现了很多蓄意报复社会的事件。前两年网络还流行了“献忠”一词，这个词语源自明末张献忠屠蜀的历史，用来指代现在这些极端的无差别杀人事件，虽然这个词语早已被国内网络封杀，但仍然掩盖不了社会矛盾的严重性。</p><p>因此现在要特别注意自己的言行，避免无意甚至故意刺激他人，避免与人产生矛盾：</p><ul><li>保持文明，例如说话礼貌客气，不要随意插队，开车不要加塞，不给别人捅你的理由。</li><li>不要露富，不要让别人觉得你过得比别人好，更不要因为你过得好所以瞧不起别人，否则会招引不必要的仇恨，而且被捅死了别人也只会拍手称快。</li><li>不要主动惹事，特别是民工、保安、司机、外卖员、快递员、服务员等这类容易遭到歧视的社会群体。当你与他们争执时，要考虑到他们可能会当场拿刀捅你；当你按下“投诉”按钮时，要考虑到他们可能会事后提着刀子堵你家门口。</li><li>如果预感要发生矛盾，可以抓紧赶在对方仇恨值上升之前认怂。你认怂，你只是丢了面子；你争强好胜，你可能会丢掉性命。</li><li>在公共场合要更加注意安全，远离危险源，出事时不要围观，防止倒霉卷入危险事件。</li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;疫情结束了，可是疫情还有后遗症，不仅对个人身体有影响，对经济环境也会有影响。作为普通人，在新的一年里，我们还要注意什么呢？&lt;/p&gt;</summary>
    
    
    
    <category term="闲谈" scheme="https://plusnan.me/categories/%E9%97%B2%E8%B0%88/"/>
    
    
  </entry>
  
  <entry>
    <title>为什么不使用GPT</title>
    <link href="https://plusnan.me/2022/12/30/why-not-gpt/"/>
    <id>https://plusnan.me/2022/12/30/why-not-gpt/</id>
    <published>2022-12-29T16:00:00.000Z</published>
    <updated>2024-01-30T06:03:00.003Z</updated>
    
    <content type="html"><![CDATA[<p>ChatGPT火了，业界甚至直呼，再不掌握人工智能，就要被时代淘汰了。</p><p>身边已经有人开始使用GPT来作为信息检索工具，并且享受到了这种有问必答的便利，那么为什么还要等着被“淘汰”呢？</p><span id="more"></span><p>从ChatGPT的原理上讲，它是基于现有的资料进行“学习”，然后形成“知识库”，因此它回答问题的质量依赖于样本的质量。</p><p>然而互联网上简体中文内容的质量是比较差劲的，在一般内容方面，一方面由于中国的网络审查，很多信息是无法正常发出，使得言论带有一定的偏向性，另一方面由于自媒体的内卷，他们大量使用“营销号”的方式生成内容，并没有提供有意义的信息；在技术内容方面，大家则总是抄来抄去，经常得不到想要的答案，从而不得不换用英文来进行检索。ChatGPT用此来作为样本进行学习，所以它的知识水平自然不会高于这些资料。</p><p>另一方面，当AI普及后，AI也有可能会反过来污染自己。当ChatGPT流行后，它能快速生成信息，而且内容看起来逻辑缜密，不像AI生成内容，所以将来会有越来越多的人使用AI来编写文章，简单改改就去发布。这些AI生成信息未来可能也会成为AI学习的样本，形成一种“内卷”，从而使AI“智力”下降。</p><p>由此可见，还是要带着一种怀疑的态度来看待ChatGPT给出的答案，并且通过自己的经验和Google搜索来判断答案的可靠性。不过，既然GPT的结果也要用Google来核实，而且Google查到的可能还是GPT的结果，那为什么不直接用Google来搜索和核实呢？</p><p>最后附一段ChatGPT提供的信息与核实的结果，如果没看过相关的动漫，很容易就上当了：</p><figure><img src="/img/2022-12-30-why-not-gpt/gpt1.png" alt="example" /><figcaption aria-hidden="true">example</figcaption></figure><figure><img src="/img/2022-12-30-why-not-gpt/gpt2.png" alt="moegirl" /><figcaption aria-hidden="true">moegirl</figcaption></figure><p>备注：椎名真白是日本动漫《樱花庄的宠物女孩》的女主角，是一名绘画天才，但生活完全不能自理，需要男主照顾，其魅力在于若无其事地白给，满足了宅男们的妄想。跟《偶像大师》没有任何关系。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ChatGPT火了，业界甚至直呼，再不掌握人工智能，就要被时代淘汰了。&lt;/p&gt;
&lt;p&gt;身边已经有人开始使用GPT来作为信息检索工具，并且享受到了这种有问必答的便利，那么为什么还要等着被“淘汰”呢？&lt;/p&gt;</summary>
    
    
    
    <category term="闲谈" scheme="https://plusnan.me/categories/%E9%97%B2%E8%B0%88/"/>
    
    
    <category term="ChatGPT" scheme="https://plusnan.me/tags/ChatGPT/"/>
    
  </entry>
  
  <entry>
    <title>如何做PPT</title>
    <link href="https://plusnan.me/2022/11/05/how-to-make-ppt/"/>
    <id>https://plusnan.me/2022/11/05/how-to-make-ppt/</id>
    <published>2022-11-04T16:00:00.000Z</published>
    <updated>2024-01-21T09:49:58.679Z</updated>
    
    <content type="html"><![CDATA[<p>做PPT还不简单吗？拿PowerPoint（WPS演示）捅一捅，PPT不就出来了吗？</p><p>如果阅读过本系列前两篇文章《<ahref="/2020/02/20/how-to-write-document/">如何写好软件文档</a>》和《<ahref="/2020/10/24/how-to-draw-graph/">如何画架构图</a>》，肯定就知道把PPT做好还是需要一点经验的。下面就是PPT的经验分享。</p><span id="more"></span><h1 id="明确受众">明确受众</h1><p>做PPT之前要想好目标和主题，你汇报的是什么呢？听众是谁，做什么事情的，关心什么东西呢？</p><p>受众不同，即使可以使用同一个PPT，讲法也会有所不同。以产品功能介绍为例：</p><ol type="1"><li>与外部单位交流：要点出产品的主要功能，强调公司和产品的优势，不要讲产品的技术细节或操作方法，除非客户主动提问。</li><li>向甲方汇报项目情况：产品功能点到即可，不用花太多时间去讲，要把主要精力放在如何实施、工程节点、保障措施等方面。</li><li>向用户培训：产品的主要功能也是点到即可，但是要强调产品的具体操作方法，如果有条件，最好使用真实产品进行现场演示，而不是简单地念PPT。</li></ol><h1 id="列好大纲">列好大纲</h1><p>汇报通常按“总-分”结构进行，先介绍总体情况，然后再详细叙述。为了使思路更加清晰，可利用思维导图工具来打草稿，理清思路后再填充内容。</p><p>如果你没有做过相关汇报，不熟悉其中的套路，可找领导或同事要一些类似的资料，到网上找现成的模板，并且不要急于把PPT做出来，而是先编写大纲，跟有经验的领导和同事确认思路是否正确，然后才开始制作，以免浪费时间。</p><p>举两个例子：</p><h2 id="项目计划">项目计划</h2><p>按照听众群体，可以分为对内汇报和对外汇报。对内汇报则强调内部的分工安排，明确时间节点以及团队各成员的职责，而对外汇报则需要强调时间节点，以及如何保障按时保质保量地交工。</p><figure><img src="/img/2022-11-05-how-to-make-ppt/example1.png"alt="项目计划示例" /><figcaption aria-hidden="true">项目计划示例</figcaption></figure><h2 id="年终个人总结">年终个人总结</h2><p>年终个人总结的目的是向部门领导和同事介绍自己的工作情况，证明自己对团队作出了贡献，并在此基础上作出总结和展望。</p><p>作为一个小工，总体结构大致如下：</p><figure><img src="/img/2022-11-05-how-to-make-ppt/example2.png"alt="年终个人总结示例" /><figcaption aria-hidden="true">年终个人总结示例</figcaption></figure><h1 id="挑选设计">挑选设计</h1><p>关于PPT模板，如果你的单位有统一模板，那么就直接用统一模板，不要再自己去设计模板。</p><p>如果没有现成模板，建议挑一些设计简洁但又不简陋的模板，无关要素越少越好，别人看的是你的汇报内容，不是看你的PPT多漂亮。</p><h2 id="样式">样式</h2><p>由于PPT通常是利用投影仪或电视机之类设备播放的，不像看纸质文件那样清晰，所以在具体的设计方面，要注意一些细节问题：</p><ul><li>颜色：颜色要具有一定的对比度，例如白色背景可以配黑色、红色或蓝色文字，而黑色背景可以配白色、黄色或绿色文字，这样可以让人能看清楚其中的内容。</li><li>字体：文字线条不要太细。另外尽量选用电脑系统自带字体，例如微软雅黑，如果你的PPT需要用别人电脑播放，可以确保不会缺字体。</li><li>字号：字号尽量不要小于28，再小的话，距离远了看不清。如果目标听众里面有老年人，因为老年人花眼，文字要更大一些。</li></ul><h2 id="内容">内容</h2><p>PPT内容要尽量多样化，例如：</p><ul><li>像本段内容一样，使用项目符号和编号来编排内容，增加层次感。</li><li>配置一些图片，或者摆放一些抽象的符号，避免一味地堆砌文字，以免内容枯燥。</li><li>使用文本框、流程图等方式来重排文字，用错位排布、流程分布等形式，让内容更加直观。</li><li>使用幻灯片动画来展现内容。例如一张幻灯片内有五段话，你可以不让它们同时显示出来，而是增加动画并通过鼠标控制，每讲一个主题时才显示一段话。</li></ul><h1 id="撰写讲稿">撰写讲稿</h1><p>讲稿是你汇报时要讲的内容。如果汇报比较重要，容不得失误，或者你的经验不足，担心讲不好，最好提前写一份讲稿，放在PPT的下方。</p><p>如果你利用了PPT下方的“单击此处添加备注”，在正式汇报时，投影仪上显示的是正式的PPT，而你的屏幕上会显示这份讲稿：</p><figure><img src="/img/2022-11-05-how-to-make-ppt/report1.png" alt="report1" /><figcaption aria-hidden="true">report1</figcaption></figure><figure><img src="/img/2022-11-05-how-to-make-ppt/report2.png" alt="report2" /><figcaption aria-hidden="true">report2</figcaption></figure><p>有些汇报总是要讲一些场面话和官话，这种话大家都不爱听，也不解决问题，但是还必须要讲，所以可以把讲稿直接写在PPT上，直接照着念就行了。</p><p>有的时候讲稿太长了，而且是一些解释性的东西，这种就不建议全部贴到PPT上，可以挑一些重点放到PPT上，其他内容等到讲的时候再详细去说。</p><h1 id="确认内容">确认内容</h1><p>PPT不要赶在deadline时才完成初稿。有些情况下，你需要跟领导确认内容，所以要留出返工的时间。</p><h1 id="本系列文档">本系列文档</h1><ul><li><ahref="/2020/02/20/how-to-write-document/">如何写好软件文档</a></li><li><a href="/2020/10/24/how-to-draw-graph/">如何画架构图</a></li><li><strong>如何做PPT</strong></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;做PPT还不简单吗？拿PowerPoint（WPS演示）捅一捅，PPT不就出来了吗？&lt;/p&gt;
&lt;p&gt;如果阅读过本系列前两篇文章《&lt;a
href=&quot;/2020/02/20/how-to-write-document/&quot;&gt;如何写好软件文档&lt;/a&gt;》和《&lt;a
href=&quot;/2020/10/24/how-to-draw-graph/&quot;&gt;如何画架构图&lt;/a&gt;》，肯定就知道把PPT做好还是需要一点经验的。下面就是PPT的经验分享。&lt;/p&gt;</summary>
    
    
    
    <category term="一点人生的经验" scheme="https://plusnan.me/categories/%E4%B8%80%E7%82%B9%E4%BA%BA%E7%94%9F%E7%9A%84%E7%BB%8F%E9%AA%8C/"/>
    
    
    <category term="文档" scheme="https://plusnan.me/tags/%E6%96%87%E6%A1%A3/"/>
    
    <category term="PPT" scheme="https://plusnan.me/tags/PPT/"/>
    
  </entry>
  
  <entry>
    <title>养成随手存档的习惯！</title>
    <link href="https://plusnan.me/2022/10/16/archive/"/>
    <id>https://plusnan.me/2022/10/16/archive/</id>
    <published>2022-10-15T16:00:00.000Z</published>
    <updated>2024-01-21T02:56:04.114Z</updated>
    
    <content type="html"><![CDATA[<p>网上的东西很容易消失，而中国网站的东西更容易“404”（“被”消失），虽然我们无法改变中国“404”的制度，但是我们仍然可以学习一些存档与找回存档的操作方法，养成随手存档的习惯，及时备份对自己有意义的内容，尽量降低损失。</p><span id="more"></span><h1 id="随手存档的重要性">随手存档的重要性</h1><p>信息会随时消失！</p><p>消失与“被消失”太常见了，例如：</p><ul><li>信息爆炸：旧的信息被新的信息冲刷掉，而信息发布平台的检索功能又不好用，使得旧的信息很难再被找到了。</li><li>主动删除：信息发布者出于各种原因，主动修改甚至删除了信息。</li><li>商业利益：信息平台为了商业利益，开始给免费、公开的内容增加限制，变成“会员专享”。</li><li>违反法律：信息或平台因盗版、诽谤等原因下架。</li><li>政治敏感：信息或平台因“政治敏感”被勒令下架。很多情况下，网站为了自己生存，担心被“查水表”，即使“有关部门”不介入，他们也会主动删除某些与官方相左的信息。</li><li>运营问题：网站升级、改版，内容发生变化，历史数据丢失。再过几年，网站经营不善，公司倒闭，网站关闭了。</li></ul><p>有的时候，信息消失得还很快。当你还没看完全文的时候，审核员早已让内容消失了。手速慢一点的话，也不过是几分钟到几小时的事情。</p><p>国内网站由于各种原因，信息消失速度通常很快，但是国外网站也不代表绝对安全：例如触犯了国外平台的规则（侵权），或者信息发布者在国内，而且被警察请去喝茶了，内容也有可能消失。</p><h1 id="如何存档">如何存档</h1><p>根据不同情况，可以考虑不同的存档方法。需要记住的是，如果你认为信息有意义，那么要养成随手存档的习惯，而不要简单地点赞、收藏、转发，否则等内容消失的时候就麻烦了。</p><h2 id="截屏拍照或录像">截屏、拍照或录像</h2><p>具体操作方法请自行Google搜索，这里不再解释。</p><h2 id="互联网档案馆">互联网档案馆</h2><p><span class="exturl" data-url="aHR0cHM6Ly9hcmNoaXZlLm9yZy8=">archive.org<i class="fa fa-external-link-alt"></i></span>（互联网档案馆，又名时光机）与<span class="exturl" data-url="aHR0cDovL2FyY2hpdmUuaXMv">archive.is<i class="fa fa-external-link-alt"></i></span>是两个常用的归档网站。只要在里面输入网址，点击保存，页面内容就会被抓取下来。之后也可以通过这两个网站查阅网站存档记录。因为这样非常有利于防止“404”，所以很早就获得了墙的认证。</p><p>截图与转载都可以造假，而归档网站保存的是网页原貌、网页原始网址与原始时间，不太可能造假。</p><p>建议在浏览器安装一个归档插件，例如Save To The Wayback Machine（<span class="exturl" data-url="aHR0cHM6Ly9jaHJvbWUuZ29vZ2xlLmNvbS93ZWJzdG9yZS9kZXRhaWwvc2F2ZS10by10aGUtd2F5YmFjay1tYWNoaS9lZWJwaW9hYWlsYmpvam1kYm1scG9tZmdpam5sY2Vtaz9obD1lbg==">Chrome版<i class="fa fa-external-link-alt"></i></span>、<span class="exturl" data-url="aHR0cHM6Ly9hZGRvbnMubW96aWxsYS5vcmcvZW4tVVMvZmlyZWZveC9hZGRvbi9zYXZlLXRvLXRoZS13YXliYWNrLW1hY2hpbmUv">Firefox版<i class="fa fa-external-link-alt"></i></span>），这样就方便随手归档了。一旦页面404，你和其他人都可以用此插件方便地查阅档案馆记录。</p><p>如果网站需要登录才能访问，或者限制国外IP访问，那么归档起不到作用了。而且，archive.org会遵守robots规范（User-Agent:ia_archiver），如果网站在robots.txt中明确拒绝归档，那么archive.org就不会保存内容，需要改用archive.is存档。</p><h2 id="笔记软件">笔记软件</h2><p>Evernote（中国版称作“印象笔记”，账号内容与国际版隔离）与OneNote是两个笔记软件，均具备收藏网页内容的功能。</p><p>Evernote对网页内容提取得比较好。像新闻资讯等网站，它会聪明地提取出标题与正文，基本上不需要进一步加工精炼。然而，Evernote免费账号只允许登录两个设备，笔记容量也有很大限制，而且中国版的“印象笔记”不支持分享功能。</p><p>OneNote提取，可以选择截图、纯文字或选区。个人感觉在内容提取方面不如Evernote好用，但是在笔记整理方面优于Evernote。</p><p>个人建议：如果想提取图文，不想直接截图，那么用Evernote保存、抓取内容。如果要进一步整合资源，形成论文、报告什么的，就切换到OneNote整理。</p><h2 id="下载到本地">下载到本地</h2><p>将网上的内容下载到本地是最安全的方法之一。只要磁盘没坏，没感染病毒，没被勒索软件勒索，没有误删，资源就不会丢失。</p><p>如果要保存网页，只需轻轻地Ctrl+S，然后点击保存就可以了。</p><p>但是，保存完成后记得检查一下，因为有些网站会设法阻止你保存东西，存完也是一堆乱七八糟的程序代码。像音乐网站、视频网站等特殊网站，干脆不能Ctrl+S（除非你只想保存评论区），需要找一些专用的下载工具才行。</p><p>有些平台需要一些特殊方法下载，例如：</p><ul><li>微博帖子：<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmxpdWd1b2ZlbmcuY29tL3AvNTY3MA==">Octoman<i class="fa fa-external-link-alt"></i></span></li><li>微信公众号：<span class="exturl" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3F1ZXN0aW9uLzIyMTE0NDUx">https://www.zhihu.com/question/2211445<i class="fa fa-external-link-alt"></i></span></li><li>音视频：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NvaW1vcnQveW91LWdldA==">you-get<i class="fa fa-external-link-alt"></i></span></li></ul><h2 id="爬虫程序">爬虫程序</h2><p>如果你会编程，那么可以利用网络爬虫收集信息。到网上搜一些爬虫程序的案例，自己写个爬虫扒网站内容。有需要的话可以再买台服务器，或者找个闲置电脑，定时跑程序，实现自动归档。</p><p>如果要爬特定网站，也可以在搜索时把网站名加上，看看有没有现成的程序，节省时间。</p><h1 id="如何找回已删内容">如何找回已删内容</h1><h2 id="互联网档案馆-1">互联网档案馆</h2><p>如果你记得网站的网址，可以到<span class="exturl" data-url="aHR0cHM6Ly9hcmNoaXZlLm9yZy8=">archive.org<i class="fa fa-external-link-alt"></i></span>或<span class="exturl" data-url="aHR0cDovL2FyY2hpdmUuaXMv">archive.is<i class="fa fa-external-link-alt"></i></span>等网站碰运气，看有没有人提交过存档。</p><h2 id="google搜索">Google搜索</h2><p>如果你还记得资料的名字或内容，可以将名字或文章中的一两句话用作Google搜索的关键词，查看网上是否还有转载与备份。有时虽然内容已删，但Google自己还留着一个快照，可以在快照失效之前尽快把内容导出来。</p><h2 id="专项计划">专项计划</h2><p>有些网站会专门搜集容易遭到删除，甚至已经遭到删除的信息：</p><ul><li><span class="exturl" data-url="aHR0cHM6Ly9jaGluYWRpZ2l0YWx0aW1lcy5uZXQvY2hpbmVzZS8=">中国数字时代<i class="fa fa-external-link-alt"></i></span>：该网站由加州大学伯克利分校信息学院“逆权力实验室”（Counter-PowerLab）提供技术支持，重点关注中国的言论审查，每天会收集一些媒体与自媒体等方面的时政类内容。有时可以在该网站找到一些已经在中国被全网删除的内容或言论。</li><li><span class="exturl" data-url="aHR0cHM6Ly9mcmVld2VpYm8uY29tLw==">自由微博<i class="fa fa-external-link-alt"></i></span>：该网站会专门搜集已经遭到屏蔽的微博内容。</li><li><span class="exturl" data-url="aHR0cHM6Ly9mcmVld2VjaGF0LmNvbS8=">自由微信<i class="fa fa-external-link-alt"></i></span>：该网站专门搜集已经遭到屏蔽的微信公众号内容。</li></ul><h1 id="不要随便分享存档">不要随便分享存档</h1><p>为个人研究、收集资料而进行存档是正常操作，但是如果你计划传播资料，则要考虑传播的风险。</p><p>如果信息是因为违反法律原因消失，例如泄漏隐私、泄漏商业机密、诽谤生事等，你再将消失的信息拿出来传播，你很可能要负法律责任。另外要注意当地法律规定，某些内容（例如儿童色情）仅仅是持有就已经触犯法律了。</p><p>如果信息是因为政治原因消失，你再拿出来传播，则要小心政治后果：例如“端点星”是一个专门整理国内被删内容的网站，然而在2020年4月19日，负责运营的三个志愿者就被警方以“寻衅滋事”逮捕了。</p><h1 id="参考资料">参考资料</h1><ul><li>《<span class="exturl" data-url="aHR0cHM6Ly90ZWxlZ3JhLnBoLyVFNyVBQyVBQyVFNSU4RCU4MSVFNCVCQSU4QyVFOCU4QSU4Mi00MDQtJUU0JUJGJUExJUU2JTgxJUFGJUU0JUJGJTlEJUU1JUFEJTk4LTAyLTIx">404信息保存<i class="fa fa-external-link-alt"></i></span>》</li><li>《<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLnNodXppeWltaW4ub3JnLzM2MA==">如何找回被删除的网页/新闻<i class="fa fa-external-link-alt"></i></span>》</li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;网上的东西很容易消失，而中国网站的东西更容易“404”（“被”消失），虽然我们无法改变中国“404”的制度，但是我们仍然可以学习一些存档与找回存档的操作方法，养成随手存档的习惯，及时备份对自己有意义的内容，尽量降低损失。&lt;/p&gt;</summary>
    
    
    
    <category term="一点人生的经验" scheme="https://plusnan.me/categories/%E4%B8%80%E7%82%B9%E4%BA%BA%E7%94%9F%E7%9A%84%E7%BB%8F%E9%AA%8C/"/>
    
    
    <category term="archive" scheme="https://plusnan.me/tags/archive/"/>
    
  </entry>
  
  <entry>
    <title>外出开个小会，领导不会教你的事情</title>
    <link href="https://plusnan.me/2022/09/11/meeting/"/>
    <id>https://plusnan.me/2022/09/11/meeting/</id>
    <published>2022-09-10T16:00:00.000Z</published>
    <updated>2024-01-21T15:42:48.900Z</updated>
    
    <content type="html"><![CDATA[<p>当你作为小工，跟着领导外出开个小会，或者你成为领导，带着一个小弟出去开会，那个当小弟的要注意什么事情呢？</p><span id="more"></span><h1 id="签到">签到</h1><p>一般情况下，会务会组织签到工作。如果你不是会务，会议又有一定的重要意义（例如处于工程节点），可以尝试找负责人，并且给签到表拍个照，以便日后判断都有谁参会了。</p><h1 id="拍照">拍照</h1><p>领导通常会让小工给会议拍几张照片。然而，照片不要随便拍拍就完事，因为一方面要证明开过会议，另一方面要证明谁参加过，或者谁没有参加过这场会议。因此：</p><ol type="1"><li>等大家都坐稳之后再拍照</li><li>多换几个角度拍照</li><li>力求能在照片中看清每个与会者，以便日后辨认</li><li>有姓名牌子时，可适当抬高手机镜头，把他们的名字一同拍下来</li></ol><p>如果需要用于宣传，或者未来有可能用于宣传，可以拍几种正面角度的照片，包括从正面看会场、从正面看领导的照片，不过最好让领导要求单位派专业的人来做这件事。</p><h1 id="录音">录音</h1><p>会上要带一个录音设备，有条件的还可以上录音笔，甚至有转文字功能的那种。</p><p>除了录音以外，建议同时记录时间，例如9:30开始录音，9:40领导讲话，9:50张三做汇报，10:10李四发言……这样回放录音时就容易定位。</p><p>开会之前别忘了调试录音设备，以免什么都没录清楚。</p><h1 id="记录">记录</h1><p>会议要做记录，而且尽量每个人都做记录，这样的话，当有同事溜号的时候，就能通过其他同事的记录补充完善。</p><p>开完会议要马上整理记录内容，并且提取要点，形成正式记录。不要以为有录音就没事，因为过几天你可能就会全部忘记，甚至都不记得对方领导是谢顶还是秃子了。</p><p>不要过度依赖转文字功能，如果会上有人有地方口音，再来几句方言，那么你那里出来的可能就是“乱码”。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;当你作为小工，跟着领导外出开个小会，或者你成为领导，带着一个小弟出去开会，那个当小弟的要注意什么事情呢？&lt;/p&gt;</summary>
    
    
    
    <category term="项目管理" scheme="https://plusnan.me/categories/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/"/>
    
    
    <category term="沟通" scheme="https://plusnan.me/tags/%E6%B2%9F%E9%80%9A/"/>
    
  </entry>
  
  <entry>
    <title>如何避免被假资讯蒙蔽</title>
    <link href="https://plusnan.me/2022/08/15/get-information/"/>
    <id>https://plusnan.me/2022/08/15/get-information/</id>
    <published>2022-08-14T16:00:00.000Z</published>
    <updated>2024-01-21T10:04:33.578Z</updated>
    
    <content type="html"><![CDATA[<p>互联网每时每刻都有海量信息，有的是真实信息，有的是虚假信息。而虚假信息又有很多类别，例如博取流量、误导他人、设置骗局、发动信息战，等等，轻者影响我们的正常认知，重者让我们蒙受各种损失。我们如何来辨别其中的虚假信息，避免自己受蒙蔽呢？</p><span id="more"></span><h1 id="从欺骗手法反向思考">从欺骗手法反向思考</h1><p>我们可以了解一些常见的欺骗手法，如果能够识别出可疑信息，从而提高警惕，受蒙蔽的概率就会降低。</p><p>当你看到的信息具有以下特征时，就应该多加小心了：</p><h2 id="带有强烈感情色彩">带有强烈感情色彩</h2><p>制造虚假信息，一种常见的方法是调动你的情绪。当你带有强烈情绪的时候，你的思维就容易变得不像平常一样理智，如果在这种情况下再给你灌输某些观点，你就更容易顺着信息发布者的意图来思考，接受他们的观点。</p><p>那么发布者如何调动你的情绪呢？诉诸感情，在信息中夹杂大量感情色彩，具体来讲，就是多谈情绪和感情，并且使用明显带有感情色彩（褒义词、贬义词）的词语来叙事，从而制造出一种倾向性。</p><p>在某些网络平台中，发布者还可以通过控制评论的方式，展示具有倾向性的评论，屏蔽理性或持不同意见的评论，使得这种感情色彩更加强烈，强化传播效果。</p><p>因此，当你看到某条信息以后心里产生了强烈的情绪，例如愤怒、激动、急躁、感动等等，你就要多加留意了。</p><h2 id="阴谋论">阴谋论</h2><p>阴谋论有一个重要特征，就是认为众多事件都是由一个“神秘团体”来操纵的，例如具名的“共济会”，或者不具名的“个别人”、“某些势力”。这些团体会在全世界，或者世界的某个地区来“下一盘大棋”，通过一系列“操作”来达到“不可告人的目的”。由于阴谋论能够自圆其说，而且很难证实（证明它是真的）或证伪（证明它是假的），所以阴谋论往往有自己的市场。</p><p>那么如何对待阴谋论呢？</p><ul><li>首先要能够识别出阴谋论：有一个“组织”或“团体”、强调暗中“操纵”、逻辑严密、能够把各种事情串起来。</li><li>接下来要找到阴谋论的两个漏洞：缺乏具体证据，缺乏交叉验证。<ul><li>缺乏具体证据：假如信息说是“某团体暗中支持”，那么这个团体叫什么名字？负责人是谁？支持是在什么时间、以何种方式支持的？有泄漏出来的照片、文件等证据吗？如果是“外国势力”，他们不可能特意用中文，所以它们的原文是什么呢？</li><li>缺乏交叉验证：为了编造事件，有些人会另外“制造”证据。然而，一件值得关注的事情，通常会有不同的人（例如不同新闻媒体）以不同的渠道来进行调查，反过来说，如果大家对这件事情的说法都差不多，缺乏不同的口径，也会说明事情不靠谱。</li></ul></li></ul><p>如果你所看到的信息符合以上两个特点，那么当作小说来看就好，别当真。</p><h2 id="只说一半真话">只说一半真话</h2><p>最近几年，网络经常出现舆论事件“反转”，甚至“反转”后再“反转”的情况。为什么会出现这种情况呢？</p><p>假设当事人没有撒谎，那么就说明当事人只选择了对自己有利的部分来进行发布，隐瞒了对自己不利的信息，而很多网民属于情绪驱动，所以事态就在未经核实的情况下发酵起来。当事件更多细节被挖出之后，网民得知了事件的全貌，于是就发生了“反转”。只说一半真话，虽然不是撒谎，但其实也属于不诚实，操作不当也会引起反噬。</p><p>再举一个例子，我们经常会知道谁谁谁创业成功，挣了多少钱，然而这种报道通常也是只讲一半真话：一方面，创业成功需要运气，甚至需要关系之类见不得人的事情，不是单纯个人努力的结果；另一方面，创业有大量的失败者，而且人数远超成功者，新闻媒体不会挑这些人来报道。</p><p>所以当你看到某类事件时，不要武断地认定对错成败，因为背后可能有着你所不知道的隐情，所以最好等了解事件的全貌之后再下结论。</p><h2 id="断章取义">断章取义</h2><p>很多言论，不能单纯从言论本身来判断讲话者的看法或立场。看一段话要考虑上下文，听一段讲话要考虑说话者的背景，他可能只是在针对特定的问题来进行评论，不代表一般情况。</p><p>所以当你看到谁发表了不合常理的言论时，哪怕是“有图有真相”、“有视频有真相”，也要留意是不是被剪辑，或者被错误解读了。</p><h1 id="从信息来源思考">从信息来源思考</h1><p>评估信息的真实性，还要看信息的来源。一般来说，信息来源越权威，信息越可靠。</p><h2 id="官方渠道">官方渠道</h2><p>官方渠道，例如政府机构、行业协会、公司发布会，都有一些专业的消息发布者。他们在发布信息之前，要在单位内部进行审核，确认内容无误之后才会公诸于众，因此他们正式发布的内容可以代表他们的立场。</p><p>虽然官方消息通常是可靠的，但不代表一定是真实的，例如某些政府或公司会否认自己的问题，掩盖自己的丑闻，在某些问题上采用统一口径，等等。所以不能轻信官方消息，该怀疑的也要怀疑，该核实的也要核实。</p><h2 id="传统媒体">传统媒体</h2><p>传统媒体，例如国内外的新闻机构，他们一般有专业的编辑团队，能够亲自去调查事件，并且对记者的报道内容把关，所以他们的信息往往更加可靠。</p><p>需要注意的是，<strong>媒体是可以有立场的，所以他们可能会基于自己的立场，对事件的报道进行有倾向性的加工</strong>，例如</p><ul><li>夸大或缩小影响：吹牛，或者大事化小</li><li>选择性报道：将事情简单地“二极管”化，并且只挑正面或反面，而回避另一面</li><li>在叙述手法上做手脚：不使用中立语气，而是使用明显的褒义词或贬义词来报道</li></ul><p>另一方面，媒体不光有事实报道，还会有评论内容，例如社评和个人评论，评论不是单纯的事实报道，所以看媒体报道也要看清楚作者是谁。</p><p>对于政治方面的媒体，中文维基百科用户进行了很多讨论，形成了《<span class="exturl" data-url="aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3dpa2kvV2lraXBlZGlhOiVFNSU4RiVBRiVFOSU5RCVBMCVFNiU5RCVBNSVFNiVCQSU5MC8lRTUlQjglQjglRTglQTclODElRTYlOUMlODklRTQlQkElODklRTglQUUlQUUlRTYlOUQlQTUlRTYlQkElOTAlRTUlODglOTclRTglQTElQTg=">常见有争议来源列表<i class="fa fa-external-link-alt"></i></span>》，由于参与讨论的用户来自不同地区，他们持有各种政治立场，甚至互相对立，讨论时常伴随各种拉锯战，但最终还能形成有意义的结果，因此可以认为这个列表的结论比较客观，不会偏袒任何一方。分析同一事件时，特别是跟政治有关的事件时，最好挑一些立场不同的媒体来进行综合评估。</p><h2 id="社交媒体">社交媒体</h2><p>社交媒体很多，例如墙内的微博、微信、抖音、小红书、Bilibili，以及墙外的Twitter、Facebook、Telegram等。这些社交媒体，只要注册账号就能发布信息，因此里面的言论仅供参考。</p><p>有些人会根据社交媒体言论的倾向来判断形势，然而你所看到的，不能代表现实情况，因为社交媒体已经形成大大小小的“信息茧房”，平台会采用大数据技术，分析你的浏览记录，推送你经常关注的内容，甚至连评论区都选择性展示和屏蔽，使你看到的都是你所认同的信息。另外有些平台或作者也会积极地删帖封号，或者引入水军淹没评论区，使内容全部都是有特定倾向性的言论。</p><p>那么怎样比较可靠呢？一方面，可以找这些平台中的权威媒体，他们往往带有认证标志，另一方面，如果社交媒体中的提到的事情具备新闻价值，新闻媒体也会进行报道，而且他们会在核实之后才发布信息。所以遇到“爆料”时，我们可以“让子弹飞一会儿”。</p><h2 id="自媒体">自媒体</h2><p>很多所谓的“媒体”其实是自媒体，从技术上讲，他们也是社交媒体中的账号，但正是因为他们比其他用户更像“媒体”，所以才得名“自媒体”。</p><p>自媒体有一个特点是门槛很低，低到注册一个账号，做一些简单的认证，就可以去平台上发布信息了。像今日头条中的“新闻”，当你仔细查看作者名字的时候，可以看到各种乱七八糟的名字，这其实就是自媒体。</p><p>自媒体可以做的事情很多，大到新闻报道，小到个人分享，使网络信息更加丰富。然而，像新闻和评论这样的信息，是需要具备一定专业水平才能做的，所以看自媒体节目时，也要了解作者的背景，例如做哪些行业的，然后再决定是否关注。</p><p>像今日头条、抖音这样的平台，不要当作权威新闻来源，就当作故事汇好了。如果作者是匿名的，从未介绍过个人经历，发的视频是机器语音，还要去报道国家大事，那么最好换一个权威一些的平台。现在人工智能技术那么发达，你怎么能保证他的内容不是AI生成出来的呢？</p><h1 id="从资讯类型思考">从资讯类型思考</h1><p>信息，是一种客观性的叙述，例如什么时间在什么地点发生了什么事情。信息存在真假，不存在对错。</p><p>观点，是一种主观性的看法，例如什么事情是正确的，什么事情是错误的，应该如何，不应该如何。观点可以讨论对错，但不存在真假。</p><p>新闻也可以分为两类，一类是报道，主要目的是传递信息，另一类是评论，主要目的是发表观点。但这两者又不是割裂开的，例如评论通常要论证某个事情是正确或错误的，那么他就需要选择客观事实来进行推导、证明。</p><p>如果你想客观理性地去做分析，你就需要能够区分信息和观点。特别是当你需要做决策时，你应该全方面地选取“信息”而非“观点”来进行判断。真实的报道是你决策的依据，而评论其实是别人的推理，应当只是当做参考。</p><h1 id="查证信息">查证信息</h1><h2 id="搜索引擎">搜索引擎</h2><p>要善于使用搜索引擎来检索信息，而且要掌握一些搜索的技巧。</p><p>举个例子，当你想了解某个新闻事件的情况时，可以用“XX地区事件”这样的关键词搜索，初步收集信息。然后再加上一些关键词，例如当事人名字，“XX地区事件张三”来进一步缩小范围。如果是近期发生，还可以再从搜索结果中增加时间条件。</p><p>如果你只需要在特定网站内进行搜索，可以增加“site:xxx.com”的关键词，例如“xx事件 site:twitter.com”，这样搜索结果就都是Twitter的贴文了。</p><p>由于“谎言重复一千遍就是真理”，所以你要留意搜索结果的差异性，必要时可以通过更换语言或限制语言来进行检索。</p><p>关于搜索引擎还需要注意两个问题：</p><ol type="1"><li>搜索引擎的靠谱程度：魏则西事件揭示了莆田系的存在，还说明了“人一百度会死”。国内网站受利益驱动，加上法律限制，一碰到特定话题就直接没有结果，经常搜不到需要的内容，所以要学会翻墙搜索。</li><li>搜索的局限性：像微博、微信公众号、Facebook这样的网站会限制用户访问，甚至必须登录之后才能查看内容，所以搜索引擎也并非万能。</li></ol><h2 id="交叉验证">交叉验证</h2><p>简单来讲，如果一个信息，被多个彼此没有关联的媒体，以不同的角度来进行了报道，也就是被交叉验证，那么它就往往比较可靠。</p><p>如何来认定交叉验证的可靠性呢？这需要一些专业知识，但是我们可以看两个极端的例子：</p><ul><li>如果几家媒体都在报道同一件事情，但是它们来自好几个国家，这些国家言论自由程度很高，而且媒体对事件报道明显不是相同的口气，甚至立场相左，说明他们没有关联。</li><li>如果几家媒体都在报道同一件事情，但是它们都是一个国家的，而且媒体发表的内容也差不多，甚至一个字都不差，那么可能是“通稿”，可能是几家媒体立场差不多，也可能是有人在带风向。</li></ul><h2 id="寻找反面信息">寻找反面信息</h2><p>当你要进行重大决策的时候，例如买房、投资理财，你不能光从正面来思考问题，否则很可能会掉进陷阱。</p><p>以买房为例，很容易就能找到开发商和所在片区的正面评价，片区发展前景多么好，开发商多么可靠之类的，但是，事情总会有两面性，所以你要收集一些反面信息，例如片区的问题，开发商的维权事件等等。</p><p>这些反面信息可能会被压制，所以不一定能找得到，但是一旦找到了，而且不是简单的骂街，而是具备一定的信息，认真核实反面信息的内容，评估其影响程度。千万不要因为想买，就只相信自己想看到的话，必要时甚至要及时止损。</p><p>同样道理，当评论是一面倒的负面信息时，也有可能是有人在“带节奏”、“带风向”，所以要关注与其相关的正面信息。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;互联网每时每刻都有海量信息，有的是真实信息，有的是虚假信息。而虚假信息又有很多类别，例如博取流量、误导他人、设置骗局、发动信息战，等等，轻者影响我们的正常认知，重者让我们蒙受各种损失。我们如何来辨别其中的虚假信息，避免自己受蒙蔽呢？&lt;/p&gt;</summary>
    
    
    
    <category term="一点人生的经验" scheme="https://plusnan.me/categories/%E4%B8%80%E7%82%B9%E4%BA%BA%E7%94%9F%E7%9A%84%E7%BB%8F%E9%AA%8C/"/>
    
    
  </entry>
  
  <entry>
    <title>见人说人话，见鬼说鬼话</title>
    <link href="https://plusnan.me/2022/07/20/expression/"/>
    <id>https://plusnan.me/2022/07/20/expression/</id>
    <published>2022-07-19T16:00:00.000Z</published>
    <updated>2024-01-21T15:43:50.679Z</updated>
    
    <content type="html"><![CDATA[<p>在微博上看到了这样一个故事：</p><blockquote><p>跟讲科学的人谈科学，和信玄学的人谈玄学才是万全之策。妇产科接一产妇，要求明天剖宫产，还详细到几点几分，但是她现在还没到预产期，一切都是正常指标，没有手术指征，医生不能给她提前剖，她和家人非要，说家里人找大师给算了，孩子明天那个时间出生命格好。医生解释了半天，不听，非要剖，不然就去投诉医生态度不好……主任听说了，来解围说：人的命格天注定，瓜熟蒂落，瓜熟蒂落，你这瓜不熟，强行摘下，也就是说想逆天改命，要不得，没那个道行，强行如此，会被反噬，到时候，你们一家都不够赔。产妇和家人一商量，觉得主任说的对，走了……医生说，那一刻，觉得主任万丈光芒。</p></blockquote><p>技术人员在与他人沟通时，经常会出现陷入自己逻辑的现象，导致沟通困难。本文借助这个故事，讲一讲与人沟通的一些技巧。</p><span id="more"></span><h1 id="了解对方的知识体系与话语体系">了解对方的知识体系与话语体系</h1><p>技术人员之间进行沟通，由于双方对技术都有所了解，因此使用行话可以很容易沟通，但是一般人并不了解这些技术，使用行话自然会让他们困惑。</p><p>有一些人受自身所受教育限制，或者出于维护自己面子的需要，他会有一套自己的思想理论，而且会坚持这些理论。如果你的理论与他的理论发生冲突，自然容易发生争执。</p><p>因此，面对知识体系不同的人，不要急着用自己的技术理论进行沟通，更不要急着否定对方，而是先试探对方对技术的理解情况，了解他的理论和语言。</p><p>以前文故事为例，产妇家提到了“大师”，说明他们家不懂任何现代医学，而且具有封建迷信思想，因此不能用现代医学理论和术语来沟通，而是要用一些传统医学或封建迷信的语言来沟通。</p><h1 id="抓住主要矛盾必要时切换思路">抓住主要矛盾，必要时切换思路</h1><p>沟通的目的是解决问题，但解决问题之前需要先了解问题是什么，哪些是主要矛盾，哪些不是主要矛盾。</p><p>以前文故事为例，产妇家的诉求是早产，而做技术的人就很容易讲自己的话，然后对自己的观点进行进一步解释，例如早产需要哪些条件、对方不符合哪些条件、后果如何之类，而对方会因为听不懂，无法理解，导致沟通陷入僵局。</p><p>当沟通陷入僵局时，就不要再沿着之前的思路进行思考，而是要直接跳出这种逻辑，重新换一个思路：产妇为什么会要求早产呢？其实是因为他们听了“大师”的话，因此主要矛盾实际上不是如何否定早产，而是如何证明“大师”是错的。</p><h1 id="翻译成对方能理解的话">翻译成对方能理解的话</h1><p>搞清楚问题之后，不要直接去解答问题，而是要把你的观点整理一下，翻译成他们能够理解的词语。特别是要否定对方时，要先顺着对方的思维说话，当对方接受以后再引出自己的观点。</p><p>主任来了，他的经验丰富，知道对方只能理解“玄学”理论，因此用玄学理论与他们沟通。主任先提出“人的命格天注定”的论断，而且不说“没到预产期”，而是将其换成“你这瓜不熟，强行摘下，也就是说想逆天改命”，让对方很容易理解。在此基础上，主任稍微恐吓一下，“要不得，没那个道行，强行如此，会被反噬”，因为大师再厉害，也不可能超越天命，所以很容易就说服了对方。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;在微博上看到了这样一个故事：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;跟讲科学的人谈科学，和信玄学的人谈玄学才是万全之策。
妇产科接一产妇，要求明天剖宫产，还详细到几点几分，但是她现在还没到预产期，一切都是正常指标，没有手术指征，医生不能给她提前剖，她和家人非要，说家里人找大师给算了，孩子明天那个时间出生命格好。
医生解释了半天，不听，非要剖，不然就去投诉医生态度不好……
主任听说了，来解围说：人的命格天注定，瓜熟蒂落，瓜熟蒂落，你这瓜不熟，强行摘下，也就是说想逆天改命，要不得，没那个道行，强行如此，会被反噬，到时候，你们一家都不够赔。
产妇和家人一商量，觉得主任说的对，走了……
医生说，那一刻，觉得主任万丈光芒。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;技术人员在与他人沟通时，经常会出现陷入自己逻辑的现象，导致沟通困难。本文借助这个故事，讲一讲与人沟通的一些技巧。&lt;/p&gt;</summary>
    
    
    
    <category term="项目管理" scheme="https://plusnan.me/categories/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/"/>
    
    
    <category term="沟通" scheme="https://plusnan.me/tags/%E6%B2%9F%E9%80%9A/"/>
    
  </entry>
  
  <entry>
    <title>基于Spring Boot和若依框架实现可灵活配置的动态接口</title>
    <link href="https://plusnan.me/2022/06/08/dynamic-controller/"/>
    <id>https://plusnan.me/2022/06/08/dynamic-controller/</id>
    <published>2022-06-07T16:00:00.000Z</published>
    <updated>2024-03-01T09:16:57.581Z</updated>
    
    <content type="html"><![CDATA[<p>很多业务都是以增删改查为基础，利用若依框架，已经能够实现代码的快速生成，但需要在后端部署一些VO、Controller和Service，如需维护，依然要修改多个文件，而且要升级和重启后端系统。</p><p>如果业务只是简单的SQL或脚本，我们能否进一步简化，实现接口动态维护，不停机就能快速配置好系统接口呢？</p><span id="more"></span><h1 id="说明">说明</h1><p>如在生产系统中使用，可直接使用更为成熟的产品，例如<span class="exturl" data-url="aHR0cHM6Ly93d3cuc3Nzc3Nzc3Mub3JnLw==">magic-api<i class="fa fa-external-link-alt"></i></span>（<span class="exturl" data-url="aHR0cHM6Ly9tYWdpYy1hcGkuc3Nzc3Nzc3Mub3JnLmNuL21hZ2ljL3dlYi9pbmRleC5odG1s">在线预览<i class="fa fa-external-link-alt"></i></span>）。</p><h1 id="功能设计">功能设计</h1><p>系统主要实现以下功能：</p><ol type="1"><li>接口管理：向开发者提供接口信息管理功能，能够创建和维护接口，动态管理接口名称、接口URL、接口类型、输入参数、代码等信息。当接口数量较多时，可通过整理分组来保持可维护性。</li><li>接口调用：在接口管理功能设置好接口后，开发者无需重启后端应用，即可调用相应接口。调用时，系统后台对调用者身份和权限进行校验，校验通过后执行相应代码，返回运行结果。</li></ol><p>接口支持以下技术特性：</p><ol type="1"><li>快速配置，保存即更新，无需停机维护。</li><li>可根据需要设置或更改接口URL。</li><li>可设置或限制接口的访问方式，如GET、POST。</li><li>支持提供输入参数，并支持通过URL、JSON、form等多种方式传入参数。</li><li>支持SQL和JavaScript（要求Java版本小于15）两种类型的代码。SQL支持MyBatis的动态标签，JavaScript可获取Spring对象。</li><li>支持授权和权限验证。</li><li>支持切换数据源。</li></ol><h1 id="数据库设计">数据库设计</h1><p>设计两张表，一个为接口内容（interface_item），存储所有接口的代码；另一个为接口分组（interface_group），便于归类管理所有接口。</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> interface_item<span class="token punctuation">(</span>    id          <span class="token keyword">BIGINT</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'主键'</span>        <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>    name        <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'名称'</span><span class="token punctuation">,</span>    code        <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'接口名'</span><span class="token punctuation">,</span>    <span class="token keyword">type</span>        <span class="token keyword">TINYINT</span>       <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'类型，1-sql，2-js'</span><span class="token punctuation">,</span>    description <span class="token keyword">TEXT</span>          <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'描述'</span><span class="token punctuation">,</span>    method      <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'GET'</span> <span class="token keyword">COMMENT</span> <span class="token string">'请求方式,GET/POST'</span><span class="token punctuation">,</span>    group_id    <span class="token keyword">BIGINT</span>        <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'分组'</span><span class="token punctuation">,</span>    group_code  <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>  <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'分组'</span><span class="token punctuation">,</span>    datasource  <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>  <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'数据源'</span><span class="token punctuation">,</span>    is_enable   <span class="token keyword">TINYINT</span>       <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">1</span> <span class="token keyword">COMMENT</span> <span class="token string">'是否启用'</span><span class="token punctuation">,</span>    is_log      <span class="token keyword">TINYINT</span>       <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span> <span class="token keyword">COMMENT</span> <span class="token string">'是否记录调用日志'</span><span class="token punctuation">,</span>    permission  <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>  <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'权限标识,*表示免登录'</span><span class="token punctuation">,</span>    param       <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'输入参数'</span><span class="token punctuation">,</span>    program        <span class="token keyword">TEXT</span>       <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'代码内容'</span><span class="token punctuation">,</span>    create_by   <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>  <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建人'</span><span class="token punctuation">,</span>    create_time <span class="token keyword">DATETIME</span>      <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建时间'</span><span class="token punctuation">,</span>    update_by   <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>  <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'更新人'</span><span class="token punctuation">,</span>    update_time <span class="token keyword">DATETIME</span>      <span class="token boolean">NULL</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'更新时间'</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">'接口项目'</span><span class="token punctuation">;</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> interface_group<span class="token punctuation">(</span>    id          <span class="token keyword">BIGINT</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'主键'</span>        <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>    name        <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>                       <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'名称'</span><span class="token punctuation">,</span>    code        <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>                       <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'url'</span><span class="token punctuation">,</span>    icon        <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>                       <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'图标'</span><span class="token punctuation">,</span>    description <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>                       <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'描述'</span><span class="token punctuation">,</span>    parent_id   <span class="token keyword">BIGINT</span>                             <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'上级节点id'</span><span class="token punctuation">,</span>    create_by   <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>                       <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建人'</span><span class="token punctuation">,</span>    create_time <span class="token keyword">DATETIME</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建时间'</span><span class="token punctuation">,</span>    update_by   <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>                       <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'更新人'</span><span class="token punctuation">,</span>    update_time <span class="token keyword">DATETIME</span>                           <span class="token boolean">NULL</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'更新时间'</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">'接口分组'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>设计完成后，可使用平台的“代码生成”功能生成相应的VO、Vue等文件，并将菜单权限导入到数据库中。</p><h1 id="核心代码">核心代码</h1><p>以若依的<span class="exturl" data-url="aHR0cHM6Ly9naXRlZS5jb20veV9wcm9qZWN0L1J1b1lpLVZ1ZQ==">前后分离版本<i class="fa fa-external-link-alt"></i></span>为例来实现这个功能。下面介绍核心部分代码，完整代码参见<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2luZm5hbi9keW5hbWljLWNvbnRyb2xsZXItZGVtbw==">GitHub<i class="fa fa-external-link-alt"></i></span>。</p><h2 id="解析动态sql">解析动态SQL</h2><p>利用MyBatis的相应方法，可解析MyBatis标签：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 将SQL中的绑定参数传入到该paramMap中</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> paramMap<span class="token punctuation">;</span><span class="token comment">// 解析SQL</span><span class="token class-name">SqlSource</span> sqlSource <span class="token operator">=</span> sqlSessionTemplate<span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLanguageDriver</span><span class="token punctuation">(</span><span class="token class-name">XMLLanguageDriver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createSqlSource</span><span class="token punctuation">(</span>sqlSessionTemplate<span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rawSql<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">BoundSql</span> boundSql <span class="token operator">=</span> sqlSource<span class="token punctuation">.</span><span class="token function">getBoundSql</span><span class="token punctuation">(</span>paramMap<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">String</span> parsedSql <span class="token operator">=</span> boundSql<span class="token punctuation">.</span><span class="token function">getSql</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// SQL语句解析完成</span>ptst <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>parsedSql<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 传入参数</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ParameterMapping</span><span class="token punctuation">></span></span> parameterMappings <span class="token operator">=</span> boundSql<span class="token punctuation">.</span><span class="token function">getParameterMappings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>parameterMappings <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> parameterMappings<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ParameterMapping</span> parameterMapping <span class="token operator">=</span> parameterMappings<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>parameterMapping<span class="token punctuation">.</span><span class="token function">getMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token class-name">ParameterMode</span><span class="token punctuation">.</span><span class="token constant">OUT</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> propertyName <span class="token operator">=</span> parameterMapping<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Object</span> value <span class="token operator">=</span> paramMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>propertyName<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">TypeHandler</span> typeHandler <span class="token operator">=</span> parameterMapping<span class="token punctuation">.</span><span class="token function">getTypeHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">JdbcType</span> jdbcType <span class="token operator">=</span> parameterMapping<span class="token punctuation">.</span><span class="token function">getJdbcType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> jdbcType <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                jdbcType <span class="token operator">=</span> sqlSessionTemplate<span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getJdbcTypeForNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            typeHandler<span class="token punctuation">.</span><span class="token function">setParameter</span><span class="token punctuation">(</span>ptst<span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> jdbcType<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 准备完成，执行SQL</span><span class="token class-name">ResultSet</span> result <span class="token operator">=</span> ptst<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="获取sql执行结果中的字段名">获取SQL执行结果中的字段名</h2><p>ResultSet中有一个getMetaData函数，通过该函数可获取到查询结果中的各字段名：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ResultSet</span> result <span class="token operator">=</span> ptst<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">ResultSetMetaData</span> md <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getMetaData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> columnCount <span class="token operator">=</span> md<span class="token punctuation">.</span><span class="token function">getColumnCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> rowData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> columnCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 获取字段名称和结果</span>        rowData<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>md<span class="token punctuation">.</span><span class="token function">getColumnLabel</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>rowData<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="动态运行javascript代码">动态运行JavaScript代码</h2><p>Java自带一个名为Nashorn的JavaScript引擎（备注：从Java15开始已经移除），可通过以下代码运行：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> code<span class="token punctuation">;</span>                        <span class="token comment">// 代码</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> paramMap<span class="token punctuation">;</span>       <span class="token comment">// 用户传入的参数</span><span class="token comment">// ...</span><span class="token class-name">ScriptEngine</span> engine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ScriptEngineManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEngineByName</span><span class="token punctuation">(</span><span class="token string">"JavaScript"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 将一些Java对象传入到JS引擎中，以便在JS代码内直接调用</span>engine<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"xxx"</span><span class="token punctuation">,</span> xxxObj<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ...</span><span class="token comment">// 将代码封装至 Main 函数中，在JS代码中可通过 paramMap 获取参数。</span>code <span class="token operator">=</span> <span class="token string">"load(\"nashorn:mozilla_compat.js\"); function Main(paramMap) &#123;\n"</span> <span class="token operator">+</span> code <span class="token operator">+</span> <span class="token string">"\n&#125;"</span><span class="token punctuation">;</span><span class="token comment">// 编译并运行脚本</span><span class="token class-name">CompiledScript</span> script <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Compilable</span><span class="token punctuation">)</span> engine<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>script<span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Invocable</span> inv2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Invocable</span><span class="token punctuation">)</span> engine<span class="token punctuation">;</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 调用函数并传入参数</span>    <span class="token keyword">return</span> inv2<span class="token punctuation">.</span><span class="token function">invokeFunction</span><span class="token punctuation">(</span><span class="token string">"Main"</span><span class="token punctuation">,</span> paramMap<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchMethodException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ScriptException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="身份和权限校验">身份和权限校验</h2><p>若依已经将身份和权限校验封装为两个Service，引用即可：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 定义部分</span><span class="token annotation punctuation">@Resource</span><span class="token keyword">private</span> <span class="token class-name">TokenService</span> tokenService<span class="token punctuation">;</span><span class="token annotation punctuation">@Resource</span><span class="token keyword">private</span> <span class="token class-name">PermissionService</span> ss<span class="token punctuation">;</span><span class="token comment">// ...</span><span class="token comment">// 校验是否登录</span><span class="token class-name">HttpServletRequest</span> request <span class="token operator">=</span> <span class="token class-name">ServletUtils</span><span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">LoginUser</span> user <span class="token operator">=</span> tokenService<span class="token punctuation">.</span><span class="token function">getLoginUser</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 设置为当前用户</span>    tokenService<span class="token punctuation">.</span><span class="token function">setLoginUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ServiceException</span><span class="token punctuation">(</span><span class="token string">"认证失败"</span><span class="token punctuation">,</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">UNAUTHORIZED</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 接口限制权限</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>permission<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 进行校验</span>    <span class="token keyword">boolean</span> hasPermission <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">hasPermi</span><span class="token punctuation">(</span>permission<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasPermission<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ServiceException</span><span class="token punctuation">(</span><span class="token string">"无访问权限"</span><span class="token punctuation">,</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">FORBIDDEN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 未抛出异常则校验成功</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="支持多种请求方式">支持多种请求方式</h2><p>很简单，在Controller中把各种请求方式都写上即可。如果限定了请求方式，可以在调用invoke之后再进行校验：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/&#123;code&#125;"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ResponseBody</span><span class="token keyword">public</span> <span class="token class-name">AjaxResult</span> <span class="token function">processGet</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> code<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> paramMap<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// GET方式</span>    <span class="token keyword">return</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> code<span class="token punctuation">,</span> paramMap<span class="token punctuation">,</span> <span class="token string">"GET"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/&#123;code&#125;"</span><span class="token punctuation">,</span>        consumes <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON_VALUE</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        produces <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON_VALUE</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ResponseBody</span><span class="token keyword">public</span> <span class="token class-name">AjaxResult</span> <span class="token function">processPost</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> code<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">JSONObject</span> body<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// POST json</span>    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> key <span class="token operator">:</span> body<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> body<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> code<span class="token punctuation">,</span> params<span class="token punctuation">,</span> <span class="token string">"POST+json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/&#123;code&#125;"</span><span class="token punctuation">,</span>        consumes <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_FORM_URLENCODED_VALUE</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        produces <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON_VALUE</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ResponseBody</span><span class="token keyword">public</span> <span class="token class-name">AjaxResult</span> <span class="token function">processPost</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> code<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> params<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// POST x-www-form-urlencoded</span>    <span class="token keyword">return</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> code<span class="token punctuation">,</span> params<span class="token punctuation">,</span> <span class="token string">"POST+form"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// ...</span><span class="token keyword">private</span> <span class="token class-name">AjaxResult</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">String</span> group<span class="token punctuation">,</span> <span class="token class-name">String</span> subgroup<span class="token punctuation">,</span> <span class="token class-name">String</span> code<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> params<span class="token punctuation">,</span> <span class="token class-name">String</span> method<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Object</span> result <span class="token operator">=</span> interfaceService<span class="token punctuation">.</span><span class="token function">invokeInterface</span><span class="token punctuation">(</span>group<span class="token punctuation">,</span> subgroup<span class="token punctuation">,</span> code<span class="token punctuation">,</span> params<span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">success</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="切换数据源">切换数据源</h2><p>一句话：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 数据源名称参见 application.yaml 配置</span><span class="token class-name">DynamicDataSourceContextHolder</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"数据源名称"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="javascript工具类">JavaScript工具类</h2><p>为使JavaScript代码能够操作数据库或其他目标，需将常用函数封装到一个工具类中，并暴露给JavaScript运行环境。具体代码参见<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2luZm5hbi9keW5hbWljLWNvbnRyb2xsZXItZGVtby9ibG9iL21hc3Rlci9ydW95aS1zeXN0ZW0vc3JjL21haW4vamF2YS9jb20vcnVveWkvc3lzdGVtL3NlcnZpY2UvaW1wbC9JbnRlcmZhY2VVdGlsSW1wbC5qYXZh">InterfaceUtilImpl<i class="fa fa-external-link-alt"></i></span>。</p><h1 id="使用说明">使用说明</h1><h2 id="接口设置">接口设置</h2><p>接口设置界面如下：</p><figure><img src="/img/2022-06-08-dynamic-controller/1.png" alt="接口列表" /><figcaption aria-hidden="true">接口列表</figcaption></figure><p>当接口数量较多时，为便于维护，可先设置分组，将不同业务的接口组织到不同分组中。</p><p>选择分组，点击添加按钮，录入接口信息：</p><figure><img src="/img/2022-06-08-dynamic-controller/2.png" alt="接口信息" /><figcaption aria-hidden="true">接口信息</figcaption></figure><p>主要参数说明：</p><ul><li>接口分组、接口代号：决定接口的URL</li><li>请求方式：限制GET、POST（JSON格式）、POST（x-www-form-urlencoded），或不限制请求方式</li><li>输入参数：如接口需要输入参数，可在此处设置。例如输入参数为<code>name,id</code>，那么前端调用时需要传入name和id两个参数，在SQL中则需要通过<code>#&#123;name&#125;</code>和<code>#&#123;id&#125;</code>进行引用。</li><li>权限标识：校验接口调用者是否具有权限，即“菜单管理”中的权限标志。<code>*</code>表示无需token，留空表示需要验证Token但不限制权限。</li><li>数据源：即<code>application.yaml</code>中配置的数据源。</li></ul><p>系统提供测试功能，方便开发人员调试接口。接口的返回值为JSON，以便前端使用，具体格式类似：</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"msg"</span><span class="token operator">:</span> <span class="token string">"操作成功"</span><span class="token punctuation">,</span>    <span class="token property">"code"</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>    <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">&#123;</span>            <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"test"</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="sql配置">SQL配置</h2><p>像MyBatis一样配置即可。纯SQL可直接输入，带逻辑的SQL则需要用<code>&lt;script&gt;</code>包围，例如：</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">&lt;</span>script<span class="token operator">></span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token keyword">table</span> <span class="token keyword">WHERE</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token keyword">if</span> test<span class="token operator">=</span><span class="token string">'name != ""'</span><span class="token operator">></span><span class="token operator">AND</span> name <span class="token operator">LIKE</span> CONCAT<span class="token punctuation">(</span><span class="token comment">#&#123;name&#125;, '%')</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="javascript配置">JavaScript配置</h2><p>Nashorn引擎支持ES5的大部分特性，可通过ES5语法编程。其代码差异之处，以及Java代码调用方法，可参见<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm9yYWNsZS5jb20vZW4vamF2YS9qYXZhc2UvMTQvc2NyaXB0aW5nL2luZGV4Lmh0bWw=">Oracle手册<i class="fa fa-external-link-alt"></i></span>。</p><p>Java的包和类可用JS代码直接导入并调用，例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 导入包</span><span class="token function">importPackage</span><span class="token punctuation">(</span>com<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>service<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 导入类</span><span class="token function">importClass</span><span class="token punctuation">(</span>com<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>service<span class="token punctuation">.</span>TabService<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> serv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TabService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 导入后，可以像Java一样new实例，或者在JS环境中调用Java方法与函数</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在本系统中，可通过<code>paramMap</code>获取用户的请求参数，通过<code>AppUtil</code>来调用Java函数，例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 获取请求参数</span><span class="token keyword">var</span> name <span class="token operator">=</span> paramMap<span class="token punctuation">.</span>name <span class="token operator">||</span> <span class="token string">'未命名'</span><span class="token punctuation">;</span><span class="token comment">// 执行SQL</span><span class="token keyword">var</span> list <span class="token operator">=</span> AppUtil<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token string">'select * from sys_user'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>AppUtil<span class="token punctuation">.</span><span class="token function">executeSql</span><span class="token punctuation">(</span><span class="token string">'update tab set name = ? where id = ?'</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取Spring Bean并调用</span><span class="token keyword">var</span> tabService <span class="token operator">=</span> AppUtil<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">'tabService'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> list <span class="token operator">=</span> tabService<span class="token punctuation">.</span><span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="进一步思考">进一步思考</h1><p>由于接口配置功能可以输入任意代码，因此当然不能向一般用户开放，否则系统会被恶意代码损毁。</p><p>输入参数往往是由用户提供的，因此应当假定每个输入参数都带有恶意，例如SQL注入、超出长度范围、超出权限范围（例如将URL中的<code>?id=3</code>改为<code>?id=4</code>）等等，。SQL或JavaScript代码也应注意限制执行时间和查询结果数量，以免数据溢出或造成阻塞。</p><p>动态的接口维护功能主要目的是便利开发人员，降低维护成本，但是本代码缺少对高并发的优化，因此不建议在高并发情况下使用。</p><h1 id="todo">TODO</h1><ol type="1"><li>查阅接口调用日志</li><li>Swagger接口文档</li><li>Kotlin语言支持</li><li><a href="/2023/05/10/javet">ES6支持</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;很多业务都是以增删改查为基础，利用若依框架，已经能够实现代码的快速生成，但需要在后端部署一些VO、Controller和Service，如需维护，依然要修改多个文件，而且要升级和重启后端系统。&lt;/p&gt;
&lt;p&gt;如果业务只是简单的SQL或脚本，我们能否进一步简化，实现接口动态维护，不停机就能快速配置好系统接口呢？&lt;/p&gt;</summary>
    
    
    
    <category term="教程" scheme="https://plusnan.me/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="数据库" scheme="https://plusnan.me/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Spring Boot" scheme="https://plusnan.me/tags/Spring-Boot/"/>
    
    <category term="接口" scheme="https://plusnan.me/tags/%E6%8E%A5%E5%8F%A3/"/>
    
  </entry>
  
</feed>
